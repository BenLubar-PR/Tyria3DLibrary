!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var a;"undefined"!=typeof window?a=window:"undefined"!=typeof global?a=global:"undefined"!=typeof self&&(a=self),a.T3D=e()}}(function(){return function r(i,o,s){function l(t,e){if(!o[t]){if(!i[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(d)return d(t,!0);throw new Error("Cannot find module '"+t+"'")}var n=o[t]={exports:{}};i[t][0].call(n.exports,function(e){var a=i[t][1][e];return l(a||e)},n,n.exports,r,i,o,s)}return o[t].exports}for(var d="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({1:[function(e,a,t){var y=e("../format/file/GW2File.js"),n=e("../format/definition/ANDAT"),i=e("../format/definition/MFT"),f=e("../util/MathUtils.js"),l=e("../MapFileList"),r=function(e,a,t){this.fileListeners=[],this.dat=e,this.version=a,this.logger=t||T3D.Logger};r.prototype.parseHeaderAsync=function(e){this.onFullyLoaded=e,this.loadFilePart(this.dat,0,40,this.readANDatHeader)},r.prototype.connectInflater=function(e,a){var t=this;this.NaClInflater=e,a.addEventListener("message",function(e){t.NaClListener.call(t,e)},!0)},r.prototype.NaClListener=function(t){if("string"!=typeof t.data){var e=t.data[0];this.fileListeners[e]&&(this.fileListeners[e].forEach(function(e){var a=t.data;e(a[1],a[2],a[3],a[4])}),this.fileListeners[e]=null)}else this.logger.log(T3D.Logger.TYPE_WARNING,"NaCl threw an error",t.data)},r.prototype.readANDatHeader=function(e){this.fileHeader=e.readStruct(n),this.logger.log(T3D.Logger.TYPE_DEBUG,"Loaded Main .dat header",this.fileHeader),this.fileHeader.mftOffset=f.arr32To64(this.fileHeader.mftOffset),this.loadFilePart(this.dat,this.fileHeader.mftOffset,this.fileHeader.mftSize,this.readMFTHeader)},r.prototype.readMFTHeader=function(e){this.mft=e.readStruct(i);e.position;var a=this.mft.nbOfEntries;this.mft.entryDict={offset_0:new Uint32Array(a),offset_1:new Uint32Array(a),offset:new Float64Array(a),size:new Uint32Array(a),compressed:new Uint16Array(a)},this.logger.log(T3D.Logger.TYPE_DEBUG,"reading MFT entries");for(var t=0;t<a-1;t++)this.mft.entryDict.offset_0[t]=e.readUint32(),this.mft.entryDict.offset_1[t]=e.readUint32(),this.mft.entryDict.size[t]=e.readUint32(),this.mft.entryDict.compressed[t]=e.readUint16(),this.mft.entryDict.offset[t]=f.arr32To64([this.mft.entryDict.offset_0[t],this.mft.entryDict.offset_1[t]]),e.seek(e.position+10);var n=f.arr32To64([this.mft.entryDict.offset_0[1],this.mft.entryDict.offset_1[1]]),r=this.mft.entryDict.size[1];this.loadFilePart(this.dat,n,r,this.readMFTIndexFile)},r.prototype.readMFTIndexFile=function(e,a){var t=a/8,n=new Uint32Array(t),r=new Uint32Array(t),i=new Uint32Array(t),o=new Uint32Array(t);this.mft.baseToMft=new Uint32Array(2e6),this.mft.fileToMft=new Uint32Array(2e6);for(var s=0;s<t;s++)n[s]=e.readUint32(),r[s]=e.readUint32();this.mft.id2index={ids:n,mftIndices:r};for(s=0;s<t;s++)if(0!=n[s]||0!=r[s]){var l=r[s],d={fileId:o[l],baseId:i[l]};if(0==d.baseId?d.baseId=n[s]:0==d.fileId&&(d.fileId=n[s]),0<d.baseId&&0<d.fileId&&d.baseId>d.fileId){var f=d.baseId;d.baseId=d.fileId,d.fileId=f}this.mft.baseToMft[d.baseId]=l,o[this.mft.fileToMft[d.fileId]=l]=d.fileId,i[l]=d.baseId}this.mft.m_entryToId={baseId:i,fileId:o},this.logger.log(T3D.Logger.TYPE_DEBUG,"Finished indexing MFT ",this.mft),this.onFullyLoaded&&this.onFullyLoaded()},r.prototype.loadFileList=function(){var e=this.dat,a="fileList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size,t=localStorage.getItem(a);if(!t)return null;try{return JSON.parse(t)}catch(e){}return null},r.prototype.loadMapList=function(){var e=this.dat,a="mapList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size,t=localStorage.getItem(a);if(!t)return null;try{return JSON.parse(t)}catch(e){}return null},r.prototype.storeFileList=function(e,a){var t=JSON.stringify(a),n="fileList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size;localStorage.setItem(n,t)},r.prototype.storeMapList=function(e,a){var t="mapList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size;localStorage.setItem(t,JSON.stringify(a))},r.prototype.readFileListAsync=function(a){var t=this,e=this.mft.id2index.mftIndices,n=f.sort_unique(e,function(e,a){return t.mft.entryDict.offset[e]-t.mft.entryDict.offset[a]}),r=n.length;this.logger.log(T3D.Logger.TYPE_DEBUG,"Scanning ",r,"files");this.listFiles(n,null,0,r,8,function(e){t.fileListeners=[],t.storeFileList(t.dat,e),a(e)})},r.prototype.readMapListAsync=function(e,t){var o=this,n=this.dat,r=[],s=(new Date).getTime();this.logger.log(T3D.Logger.TYPE_PROGRESS,"Finding maps (first visit only)","initializing"),e?r=this.mft.id2index.mftIndices:l.maps.forEach(function(e){e.maps.forEach(function(e){var a=e.fileName.split(".")[0],t=o.getFileIndex(a);r.push(t)})});var a=f.sort_unique(r,function(e,a){return o.mft.entryDict.offset[e]-o.mft.entryDict.offset[a]}),i=a.length;this.logger.log(T3D.Logger.TYPE_DEBUG,"Scanning ",i," files for maps..."),this.listFiles(a,"mapc",0,i,8,function(e){var a=(new Date).getTime()-s;o.logger.log(T3D.Logger.TYPE_DEBUG,"Time elapsed ",Math.round(.001*a)," seconds"),o.fileListeners=[];var i={maps:[]};e.mapc&&e.mapc.forEach(function(e){var t=o.mft.m_entryToId.baseId[e+1],n="",r="";l.maps.forEach(function(a){a.maps.forEach(function(e){0==n.length&&0<=e.fileName.indexOf(t+".")&&(n=e.name,r=a.name)})}),0==n.length&&(n="Unknown map "+t),0==r.length&&(r="Unknown maps");var a=null;i.maps.forEach(function(e){e.name==r&&(a=e)}),a||(a={name:r,maps:[]},i.maps.push(a)),a.maps.push({fileName:t,name:n})}),o.storeMapList(n,i),t(i)})},r.prototype.listFiles=function(o,s,l,e,d,f){for(var m=this,u=l+e,h=0,c=100/Math.min(e,o.length-l),g=0,p={},v=function(t){if(t%d==0){var e=Math.min(100,Math.floor((t-l)*c));h!=e&&(m.logger.log(T3D.Logger.TYPE_PROGRESS,"Find type",e),h=e)}if(t>=o.length||u<=t)return m.logger.log(T3D.Logger.TYPE_DEBUG,"Thread ",t%d+" done"),void(++g==d&&f(p));var n=o[t];if(m.mft.entryDict.compressed[n]){var r=n,a=m.mft.entryDict.offset[n],i=m.mft.entryDict.size[n];i<32?v(t+d):m.loadFilePart(m.dat,a,Math.min(i,2e3),function(e,a){m.inflate(e,a,r,function(e){!function(e,a,t){if(!e)return m.logger.log(T3D.Logger.TYPE_WARNING,"No infalted data for entry"),v(a+d);var n,r=new DataStream(e),i=r.readCString(4);n="ATEX"==i||"ATEC"==i||"ATEP"==i||"ATET"==i||"ATEU"==i||"ATTX"==i?"Texture":0==i.indexOf("PF")?new y(r,0,!0).header.type:0==i.indexOf("MZ")?"Binary":"strs"==i?"String":"Unknown";s&&n!=s||(p[n]||(p[n]=[]),p[n].push(t)),v(a+d)}(e,t,n)},!1,32)})}else v(t+d)},a=0;a<d;a++)v(l+a)},r.prototype.getFileIndex=function(e){var a=-1;return e=parseInt(e),-1!=(a=this.mft.m_entryToId.baseId.indexOf(e))?a-1:-1!=(a=this.mft.m_entryToId.fileId.indexOf(e))?a-1:a},r.prototype.loadTextureFile=function(e,a){this.loadFile(e,a,!0)},r.prototype.loadFile=function(e,t,n,r){var i=this,a=this.getFileIndex(e),o=a;if(o<=0)return i.logger.log(T3D.Logger.TYPE_WARNING,"Could not find file with baseId ",e),void t(null);var s=f.arr32To64([this.mft.entryDict.offset_0[o],this.mft.entryDict.offset_1[o]]),l=this.mft.entryDict.size[o];if(!this.mft.entryDict.compressed[o])return i.logger.log(T3D.Logger.TYPE_WARNING,"File is NOT compressed, skipping"),void t(null);var d=a;this.loadFilePart(this.dat,s,l,function(e,a){r?t(e):i.inflate(e,a,d,t,n)})},r.prototype.inflate=function(e,a,t,n,r,i){var o=e.buffer;if(i||(i=1),o.byteLength<12)return this.logger.log(T3D.Logger.TYPE_WARNING,"not inflating, length is too short ("+o.byteLength+")",t),void n(null);123350!=t&&123409!=t&&123408!=t?this.fileListeners[t]?this.fileListeners[t].push(n):(this.fileListeners[t]=[n],this.NaClInflater.postMessage([t,o,!0===r,i])):n(null)},r.prototype.loadFilePart=function(e,a,n,r){var i=this,t=new FileReader;t.onerror=function(e){},t.onload=function(e){var a=e.target.result,t=new DataStream(a);t.endianness=DataStream.LITTLE_ENDIAN,r.call(i,t,n)};var o=a,s=o+n;t.readAsArrayBuffer(e.slice(o,s))},a.exports=r},{"../MapFileList":3,"../format/definition/ANDAT":13,"../format/definition/MFT":14,"../format/file/GW2File.js":16,"../util/MathUtils.js":18}],2:[function(e,a,t){var n={TYPE_ERROR:4,TYPE_WARNING:3,TYPE_MESSAGE:2,TYPE_PROGRESS:1,TYPE_DEBUG:0};n.logFunctions=new Array(5),n.log=function(){if(0!=arguments.length){var e=n.argsToArr(arguments);1==e.length&&e.unshift(n.TYPE_MESSAGE);var a=Math.max(0,Math.min(n.logFunctions.length,e.shift()));n.logFunctions[a].apply(this,e)}},n.argsToArr=function(e){for(var a=new Array(e.length),t=0;t<a.length;++t)a[t]=e[t];return a},n.logFunctions[n.TYPE_ERROR]=function(){console.error.apply(console,arguments)},n.logFunctions[n.TYPE_WARNING]=function(){console.warn.apply(console,arguments)},n.logFunctions[n.TYPE_MESSAGE]=function(){console.log.apply(console,arguments)},n.logFunctions[n.TYPE_PROGRESS]=function(){var e=n.argsToArr(arguments);e.unshift("Progress: "),console.log.apply(console,e)},n.logFunctions[n.TYPE_DEBUG]=function(){var e=n.argsToArr(arguments);console.debug.apply(console,e)},a.exports=n},{}],3:[function(e,a,t){a.exports={maps:[{name:"01. Shiverpeaks",maps:[{fileName:"125199.data",name:"Wayfarer Foothills (0)"},{fileName:"187611.data",name:"Wayfarer Foothills (1)"},{fileName:"568778.data",name:"Cragstead"},{fileName:"132434.data",name:"Hoelbrak (0)"},{fileName:"197122.data",name:"Hoelbrak (1)"},{fileName:"124093.data",name:"Snowden Drifts (0)"},{fileName:"186397.data",name:"Snowden Drifts (1)"},{fileName:"275155.data",name:"Dredgehaunt Cliffs"},{fileName:"276252.data",name:"Frostgorge Sound"},{fileName:"277587.data",name:"Lornar's Pass"},{fileName:"278717.data",name:"Timberline Falls (0)"},{fileName:"846866.data",name:"Timberline Falls (1)"},{fileName:"1018612.data",name:"Timberline Falls (2)"},{fileName:"295282.data",name:"Eye of the North"}]},{name:"02. Ascalon",maps:[{fileName:"126118.data",name:"Plains of Ashford (0)"},{fileName:"188591.data",name:"Plains of Ashford (1)"},{fileName:"127888.data",name:"Diessa Plateau (0)"},{fileName:"190490.data",name:"Diessa Plateau (1)"},{fileName:"131944.data",name:"Black Citadel (0)"},{fileName:"196585.data",name:"Black Citadel (1)"},{fileName:"280025.data",name:"Blazeridge Steppes"},{fileName:"281313.data",name:"Fireheart Rise"},{fileName:"282668.data",name:"Iron Marches"},{fileName:"283574.data",name:"Fields of Ruin"}]},{name:"03. Kryta",maps:[{fileName:"191000.data",name:"Lion's Arch (0)"},{fileName:"814803.data",name:"Lion's Arch (1)"},{fileName:"1019669.data",name:"Lion's Arch (Legacy)"},{fileName:"1796999.data",name:"Lion's Arch (2)"},{fileName:"1869665.data",name:"Lion's Arch (3)"},{fileName:"128151.data",name:"Divinity's Reach (0)"},{fileName:"191265.data",name:"Divinity's Reach (1)"},{fileName:"705746.data",name:"Divinity's Reach (2)"},{fileName:"129834.data",name:"North of Divinity's Reach (0)"},{fileName:"193081.data",name:"North of Divinity's Reach (1)"},{fileName:"129524.data",name:"Queensdale (0)"},{fileName:"192711.data",name:"Queensdale (1)"},{fileName:"130970.data",name:"Kessex Hills (0)"},{fileName:"194288.data",name:"Kessex Hills (1)"},{fileName:"672138.data",name:"Kessex Hills (2)"},{fileName:"861815.data",name:"Kessex Hills (3)"},{fileName:"286945.data",name:"Bloodtide Coast"},{fileName:"287870.data",name:"Harathi Hinterlands"},{fileName:"289176.data",name:"Gendarran Fields"},{fileName:"295005.data",name:"Chantry of Secrets"},{fileName:"294938.data",name:"Claw Island"}]},{name:"04. Maguuma Jungle",maps:[{fileName:"195149.data",name:"Caledon Forest"},{fileName:"195493.data",name:"Metrica Province"},{fileName:"922320.data",name:"Metrica Province Instance"},{fileName:"198076.data",name:"The Grove"},{fileName:"198272.data",name:"Rata Sum"},{fileName:"291064.data",name:"Mount Maelstrom"},{fileName:"292254.data",name:"Sparkfly Fen"},{fileName:"293307.data",name:"Brisban Wildlands"}]},{name:"05. Ruins of Orr",maps:[{fileName:"284829.data",name:"Straits of Devastation"},{fileName:"285089.data",name:"Malchor's Leap"},{fileName:"285634.data",name:"Cursed Shore"},{fileName:"295179.data",name:"Cathedral of Hidden Depths"},{fileName:"295962.data",name:"A Light in the Darkness"}]},{name:"06. Living World S1",maps:[{fileName:"520479.data",name:"Southsun Cove"},{fileName:"679089.data",name:"Tower of Nightmares"}]},{name:"07. Living World S2",maps:[{fileName:"836211.data",name:"Dry top (0)"},{fileName:"861770.data",name:"Dry top (1)"},{fileName:"909361.data",name:"The Silverwastes (0)"},{fileName:"996202.data",name:"The Silverwastes (1)"},{fileName:"908730.data",name:"Glint's Lair"}]},{name:"08. Heart of Maguuma",maps:[{fileName:"969663.data",name:"Verdant Brink"},{fileName:"1262460.data",name:"Hearts and Minds"},{fileName:"969964.data",name:"Unknown Airship in tree"},{fileName:"1262310.data",name:"Dragon Stand"},{fileName:"1263739.data",name:"Tarir"},{fileName:"1264291.data",name:"Tangled Depths"}]},{name:"09. Living World S3",maps:[{fileName:"1472635.data",name:"(E1) Bloodstone Fen"},{fileName:"1498071.data",name:"(E2) Taimi Simulator"},{fileName:"1498578.data",name:"(E2) Ring of Fire"},{fileName:"1605211.data",name:"(E3) Bitterfrost Frontier"},{fileName:"1645474.data",name:"(E4) Caudecus Manor"},{fileName:"1646520.data",name:"(E4) Lake Doric"},{fileName:"1682493.data",name:"(E5) Draconis Mons"},{fileName:"1682763.data",name:"(E5) Titan's Throat"},{fileName:"1734839.data",name:"(E6) White Mantle Fortress"},{fileName:"1735346.data",name:"(E6) Siren's Landing"},{fileName:"1735440.data",name:"(E6) Shining Blade Headquarters"}]},{name:"10. Crystal Desert",maps:[{fileName:"1794574.data",name:"Crystal Oasis"},{fileName:"1833034.data",name:"Desert Highlands"},{fileName:"1833726.data",name:"PoF story instances"},{fileName:"1839188.data",name:"Domain of Vabbi"},{fileName:"1840103.data",name:"Elon Riverlands"},{fileName:"1840368.data",name:"Kormir Sanctuary"},{fileName:"1842533.data",name:"The Desolation"}]},{name:"11. Living World S4",maps:[{fileName:"1901428.data",name:"(E1) Fahranur"},{fileName:"1902235.data",name:"(E1) Istan"},{fileName:"1903523.data",name:"(E1) Crystal Oasis"},{fileName:"1954984.data",name:"(E2) Desert Highlands"},{fileName:"1955224.data",name:"(E2) Inquest Lab Tower"},{fileName:"1955471.data",name:"(E2) Rata Primus"},{fileName:"1955642.data",name:"(E2) Divinity's Reach"},{fileName:"1955915.data",name:"(E2) Mount Maelstrom"},{fileName:"1956140.data",name:"(E2) Frostgorge Sound"},{fileName:"1956245.data",name:"(E2) Void"},{fileName:"1956299.data",name:"(E2) Hided Inquest Lab"},{fileName:"1957526.data",name:"(E2) Sandswept Isles"},{fileName:"2004704.data",name:"(E3) Domain of Kourna"},{fileName:"2005467.data",name:"(E3) Crystal Oasis"},{fileName:"2044320.data",name:"(E4) Jahai Bluffs"},{fileName:"2044502.data",name:"(E4) The Mists"},{fileName:"2092435.data",name:"(E5) Thunderhead Peaks"},{fileName:"2092812.data",name:"(E5) The Auditorium (0)"},{fileName:"2093450.data",name:"(E5) The Auditorium (1)"},{fileName:"2093791.data",name:"(E5) Glint's Trials"},{fileName:"2146125.data",name:"(E6) Dragonfall"},{fileName:"2146312.data",name:"(E6) The Auditorium"},{fileName:"2146346.data",name:"(E6) Dragonflight"},{fileName:"2146376.data",name:"(E6) Sayida's Airship"},{fileName:"2146510.data",name:"(E6) Descent"}]},{name:"12. Seasonal Activities",maps:[{fileName:"506592.data",name:"Ascent to Madness"},{fileName:"506670.data",name:"Mad King's Labyrinth (Past)"},{fileName:"662436.data",name:"Mad King's Labyrinth (Present)"},{fileName:"506739.data",name:"Mad King's Clock Tower"},{fileName:"622681.data",name:"The Crown Pavilion"},{fileName:"569756.data",name:"SAB Hub (0)"},{fileName:"636133.data",name:"SAB Hub (1)"},{fileName:"635555.data",name:"SAB World 1"},{fileName:"635960.data",name:"SAB World 2"},{fileName:"606255.data",name:"Zephyr Sanctum"},{fileName:"529896.data",name:"Tixx's Infinirarium"},{fileName:"529945.data",name:"Winter Wonderland"},{fileName:"2076921.data",name:"Secret Lair of the Snowmen"}]},{name:"13. Activites",maps:[{fileName:"605983.data",name:"Sanctum Sprint"},{fileName:"606030.data",name:"Basket Brawl"}]},{name:"14. Dungeons",maps:[{fileName:"126840.data",name:"Ascalonian Catacombs (0)"},{fileName:"189364.data",name:"Ascalonian Catacombs (1)"},{fileName:"275474.data",name:"Sorrow's Embrace"},{fileName:"276520.data",name:"Honor of the Waves"},{fileName:"284039.data",name:"Citadel of Flame"},{fileName:"287214.data",name:"Caudecus's Manor"},{fileName:"291284.data",name:"Twilight Arbor (0)"},{fileName:"645968.data",name:"Twilight Arbor (1)"},{fileName:"293606.data",name:"Crucible of Eternity"},{fileName:"473930.data",name:"The Ruined City of Arah"},{fileName:"473765.data",name:"Arah - Story"},{fileName:"580061.data",name:"Molten Facility"},{fileName:"595722.data",name:"Aetherblade Retreat"}]},{name:"15. Fractals",maps:[{fileName:"519839.data",name:"Fractals of the Mists"},{fileName:"697450.data",name:"Thaumanova Reactor"},{fileName:"1426653.data",name:"Cliffside Fractal"},{fileName:"1472361.data",name:"Chaos Isle Fractal"},{fileName:"1472382.data",name:"Snowblind Fractal"},{fileName:"1472406.data",name:"Swampland Fractal"},{fileName:"1498016.data",name:"Mistlock Observatory"},{fileName:"1498798.data",name:"Aetherblade/Mai Trin Fractal"},{fileName:"1605344.data",name:"Nightmare Fractal"},{fileName:"1733857.data",name:"Shattered Observatory Fractal"},{fileName:"1733961.data",name:"Mistlock Sanctuary"},{fileName:"1905739.data",name:"Molten Boss Fractal"},{fileName:"1905889.data",name:"Twilight Oasis Fractal"},{fileName:"2005713.data",name:"Deepstone Fractal"},{fileName:"2094098.data",name:"Siren's Reef Fractal"}]},{name:"16. Raid",maps:[{fileName:"1151420.data",name:"(W1) Spirit Vale"},{fileName:"1383309.data",name:"(W2) Salvation Pass"},{fileName:"1427048.data",name:"Special Forces Training Area"},{fileName:"1454070.data",name:"(W3) Stronghold of the Faithful"},{fileName:"1645215.data",name:"(W4) Bastion of the Penitent"},{fileName:"1906329.data",name:"(W5) Hall of Chains"},{fileName:"2045250.data",name:"(W6) Mythwright Gambit"}]},{name:"17. Structured PvP",maps:[{fileName:"871093.data",name:"Original Stronghold"},{fileName:"870987.data",name:"Battle of Champion's Dusk (0)"},{fileName:"1666233.data",name:"Battle of Champion's Dusk (1)"},{fileName:"132570.data",name:"Heart of the Mists (0)"},{fileName:"197249.data",name:"Heart of the Mists (1)"},{fileName:"1734729.data",name:"Heart of the Mists (2)"},{fileName:"2129692.data",name:"Heart of the Mists (4)"},{fileName:"1712986.data",name:"Hall of the Mists"},{fileName:"132710.data",name:"The Battle of Khylo (0)"},{fileName:"197402.data",name:"The Battle of Khylo (1)"},{fileName:"132837.data",name:"Forest of Niflhel (0)"},{fileName:"197545.data",name:"Forest of Niflhel (1)"},{fileName:"376916.data",name:"Legacy of the Foefire"},{fileName:"467374.data",name:"Raid on the Capricorn"},{fileName:"520609.data",name:"Temple of the Silent Storm"},{fileName:"579383.data",name:"Skyhammer (0)"},{fileName:"677968.data",name:"Skyhammer (1)"},{fileName:"1934470.data",name:"Skyhammer (2)"},{fileName:"791564.data",name:"Courtyard (0)"},{fileName:"1713054.data",name:"Courtyard (1)"},{fileName:"556199.data",name:"Spirit Watch (0)"},{fileName:"1473061.data",name:"Spirit Watch (1)"},{fileName:"506539.data",name:"Reaper's Rumble"},{fileName:"529718.data",name:"Snowball Mayhem"},{fileName:"595582.data",name:"Dragon Ball Arena"},{fileName:"617120.data",name:"Aspect Arena"},{fileName:"1644624.data",name:"Revenge of the Capricorn"},{fileName:"1704155.data",name:"Eternal Coliseum"},{fileName:"2128880.data",name:"Eternal Coliseum (1)"},{fileName:"2128938.data",name:"Djinn's Dominion"}]},{name:"18. World vs World",maps:[{fileName:"131235.data",name:"Eternal Battlegrounds (0)"},{fileName:"195806.data",name:"Eternal Battlegrounds (1)"},{fileName:"1885693.data",name:"Eternal Battlegrounds (2)"},{fileName:"1918037.data",name:"Eternal Battlegrounds (3)"},{fileName:"131574.data",name:"Alpine Borderlands (0)"},{fileName:"641501.data",name:"Alpine Borderlands (1)"},{fileName:"1799855.data",name:"Alpine Borderlands (2)"},{fileName:"1647236.data",name:"Desert Borderlands (0)"},{fileName:"1799442.data",name:"Desert Borderlands (1)"},{fileName:"2112733.data",name:"Desert Borderlands (3)"},{fileName:"736241.data",name:"Edge of the Mists"},{fileName:"2113077.data",name:"Armistice Bastion"}]},{name:"19. Guild Halls",maps:[{fileName:"1255378.data",name:"Gilded Hollow"},{fileName:"1256064.data",name:"Lost Precipice"},{fileName:"1843274.data",name:"Windswept Haven"}]},{name:"20. Miscellaneous",maps:[{fileName:"2124612.data",name:"Mists Rift"}]},{name:"21. Concept and not released",maps:[{fileName:"122695.data",name:"Empty Plane"},{fileName:"184799.data",name:"Empty Plane v1"},{fileName:"197562.data",name:"Empty Plane v2"},{fileName:"875614.data",name:"Unknown Mists Platforms"},{fileName:"132853.data",name:"Empty Box"},{fileName:"1255516.data",name:"Guild Coliseum"},{fileName:"1498193.data",name:"Concept sPVP Map 1"},{fileName:"1513556.data",name:"Concept sPVP Map 2"},{fileName:"1513607.data",name:"Concept sPVP Map 3"},{fileName:"1513620.data",name:"Concept sPVP Map 4"},{fileName:"1513675.data",name:"Concept sPVP Map 5"},{fileName:"1712945.data",name:"Concept sPVP Map 6"}]}]}},{}],4:[function(e,a,t){function l(){}LocalReader=e("./LocalReader/LocalReader.js"),a.exports=l;var n,d="1.0.4",f="modules/nacl/t3dgwtools.nmf",m="modules/t3dtools/t3dworker.js";l.version=d,l.GW2File=e("./format/file/GW2File"),l.GW2Chunk=e("./format/file/GW2Chunk"),l.DataRenderer=e("./dataRenderer/DataRenderer"),l.EnvironmentRenderer=e("./dataRenderer/EnvironmentRenderer"),l.HavokRenderer=e("./dataRenderer/HavokRenderer"),l.PropertiesRenderer=e("./dataRenderer/PropertiesRenderer"),l.ModelRenderer=e("./dataRenderer/ModelRenderer"),l.TerrainRenderer=e("./dataRenderer/TerrainRenderer"),l.ZoneRenderer=e("./dataRenderer/ZoneRenderer"),l.StringRenderer=e("./dataRenderer/StringRenderer"),l.Logger=e("./Logger"),l.MapFileList=e("./MapFileList"),l.MaterialUtils=e("./util/MaterialUtils.js"),l.MathUtils=e("./util/MathUtils.js"),l.ParserUtils=e("./util/ParserUtils.js"),l.RenderUtils=e("./util/RenderUtils.js"),l.getLocalReader=function(e,a,t,n,r){if(void 0===navigator.mimeTypes["application/x-nacl"]){var i=new Worker(r||m);(s=new LocalReader(e,d,n)).connectInflater(i,i)}else{var o=document.createElement("div");o.setAttribute("id","pNaClListener");var s,l=document.createElement("embed");l.setAttribute("type","application/x-pnacl"),l.style.position="absolute",l.style.height=0,l.style.width=0,l.setAttribute("src",t||f),o.appendChild(l),document.body.appendChild(o),(s=new LocalReader(e,d,n)).connectInflater(l,o)}return s.parseHeaderAsync(a),s},l.getFileListAsync=function(e,a){var t=e.loadFileList();t?a(t):e.readFileListAsync(a)},l.getMapListAsync=function(e,a,t){if(t)e.readMapListAsync(!0,a);else{var n=e.loadMapList();n?a(n):e.readMapListAsync(!1,a)}},l.renderMapContentsAsync=function(r,e,i,o,a){var s={};parseInt(e)?r.loadFile(e,function(e){var a=new DataStream(e,0,DataStream.LITTLE_ENDIAN),t=new l.GW2File(a,0),n=function(e){e<i.length?l.runRenderer(i[e].renderClass,r,Object.assign(i[e].settings,{mapFile:t}),s,n.bind(this,e+1)):o(s)};n(0)}):(a||l.Logger).log(l.Logger.TYPE_ERROR,"Map id must be an integer!, was:",e)},l.runRenderer=function(e,a,t,n,r){new e(a,t,n).renderAsync(r)},l.getContextValue=function(e,a,t,n){var r=e[a.name];return r&&r[t]?r[t]:n},l.hasWebGL=function(e){if(window.WebGLRenderingContext){for(var a=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1,r=0;r<4;r++)try{if((n=a.getContext(t[r]))&&"function"==typeof n.getParameter)return!e||{name:t[r],gl:n}}catch(e){}return!1}return!1},n=0,"undefined"==typeof DataStream&&(l.Logger.log(l.Logger.TYPE_ERROR,"T3D core functionality requires DataStream library."),n++),"undefined"==typeof THREE&&(l.Logger.log(l.Logger.TYPE_WARNING,"T3D mesh generation requires three.js library."),n++),n<1&&l.Logger.log(l.Logger.TYPE_MESSAGE,"Tyria 3D API v"+l.version+" initialized.")},{"./LocalReader/LocalReader.js":1,"./Logger":2,"./MapFileList":3,"./dataRenderer/DataRenderer":5,"./dataRenderer/EnvironmentRenderer":6,"./dataRenderer/HavokRenderer":7,"./dataRenderer/ModelRenderer":8,"./dataRenderer/PropertiesRenderer":9,"./dataRenderer/StringRenderer":10,"./dataRenderer/TerrainRenderer":11,"./dataRenderer/ZoneRenderer":12,"./format/file/GW2Chunk":15,"./format/file/GW2File":16,"./util/MaterialUtils.js":17,"./util/MathUtils.js":18,"./util/ParserUtils.js":19,"./util/RenderUtils.js":20}],5:[function(e,a,t){var d=e("../format/file/GW2File"),n=a.exports=function(e,a,t,n){this.localReader=e,(this.settings=a)||(a={}),this.context=t,this.context[this.constructor.name]={},this.logger=n||T3D.Logger};n.prototype.getOutput=function(e){return this.context[e?e.name:this.constructor.name]},n.prototype.renderAsync=function(s){var l=this;this.localReader.loadFile(this.settings.id,function(e){l.getOutput().fileId=l.settings.id,l.getOutput().rawData=e;for(var a=new Uint8Array(e),t=[],n=Math.min(a.length,1e4),r=0;65535*r<n;r++)t.push(String.fromCharCode.apply(null,a.subarray(65535*r,65535*(r+1))));n<a.length&&t.push("T3D Ignored the last "+(a.length-n)+" bytes when generating this raw output"),l.getOutput().rawString=t.join();var i=new DataStream(e),o=i.readCString(4);"ATEX"==o||"ATEC"==o||"ATEP"==o||"ATET"==o||"ATEU"==o||"ATTX"==o?l.localReader.loadTextureFile(l.settings.id,function(e,a,t,n){var r={data:new Uint8Array(e),width:t,height:n};l.getOutput().image=r,s()}):(0==o.indexOf("PF")?l.getOutput().file=new d(i,0):l.getOutput().file=null,s())})}},{"../format/file/GW2File":16}],6:[function(e,a,t){var d=e("../util/RenderUtils"),n=e("./DataRenderer");function r(l,e,a,t){n.call(this,l,e,a,t),this.mapFile=this.settings.mapFile,this.getMat=function(e){return new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide,fog:!1,depthWrite:!1})},this.loadTextureWithFallback=function(e,t,a,n,r){var i=this;function o(a){e.forEach(function(e){t[e]=a})}function s(){o(i.getMat(THREE.ImageUtils.loadTexture(n)))}o(i.getMat(d.loadLocalTexture(l,a,null,r,function(){setTimeout(s,1)})))},this.getHazeColor=function(e){var a=e&&e.dataGlobal.haze;return!a||a.length<=0?[190,160,60]:a[0].farColor},this.parseLights=function(e){var r=this;r.getOutput().lights=[];var n,a=e?e.dataGlobal.lighting:[{lights:[],backlightIntensity:1,backlightColor:[255,255,255]}],i=!1;a.forEach(function(e,a){if(!i){if(e.lights.forEach(function(e,a){i=!0;var t=new THREE.Color(e.color[2]/255,e.color[1]/255,e.color[0]/255),n=new THREE.DirectionalLight(t.getHex(),e.intensity);n.position.set(-e.direction[0],e.direction[2],e.direction[1]).normalize(),e.intensity,r.getOutput().lights.push(n)}),!e.lights||0==e.lights.length){[[0,1,0,.3],[1,2,1,.3],[-1,-2,-1,.3]].forEach(function(e){var a=new THREE.Color(1,1,1),t=e[3],n=new THREE.DirectionalLight(a.getHex(),t);n.position.set(e[0],e[1],e[2]).normalize(),t,r.getOutput().lights.push(n)})}e.backlightIntensity=e.backlightIntensity;var t=new THREE.Color(e.backlightIntensity*(255-e.backlightColor[2])/255,e.backlightIntensity*(255-e.backlightColor[1])/255,e.backlightIntensity*(255-e.backlightColor[0])/255);n=new THREE.AmbientLight(t)}});var t=0;n&&(t=n.color.r+n.color.g+n.color.b,this.getOutput().lights.push(n)),this.getOutput().hasLight=i||0<t},this.parseSkybox=function(e,a,t){this.getOutput().skyElements=[];var n=this.environmentChunkData&&this.environmentChunkData.dataGlobal.skyModeTex[0];n||(n={texPathNE:1930687,texPathSW:193069,texPathT:193071});var r=a.rect,i=Math.abs(r.x1-r.x2),o=Math.abs(r.y1-r.y2),s=(Math.max(i,o),[]);this.loadTextureWithFallback([1,4],s,n.texPathNE+1,"img/193068.png",t),this.loadTextureWithFallback([0,5],s,n.texPathSW+1,"img/193070.png",t),this.loadTextureWithFallback([2],s,n.texPathT+1,"img/193072.png",t),s[3]=new THREE.MeshBasicMaterial({visible:!1});var l=new THREE.BoxGeometry(1024,512,1024);l.faceVertexUvs[0].forEach(function(e,a){var t=Math.floor(a/2);0==t||1==t?e.forEach(function(e){e.x=1-e.x,e.y/=2,e.y+=.5}):5==t||4==t?e.forEach(function(e){e.y/=-2,e.y+=.5}):e.forEach(function(e){e.x=1-e.x})}),l.uvsNeedUpdate=!0;var d=new THREE.MeshFaceMaterial(s),f=new THREE.Mesh(l,d);f.translateY(256),this.getOutput().skyElements.push(f)}}((r.prototype=Object.create(n.prototype)).constructor=r).prototype.renderAsync=function(e){var a=this.mapFile.getChunk("env").data,t=this.mapFile.getChunk("parm").data,n=this.getHazeColor(a),r=256*n[2]*256+256*n[1]+n[0];this.getOutput().hazeColor=n,this.parseLights(a),this.parseSkybox(a,t,r),e()},a.exports=r},{"../util/RenderUtils":20,"./DataRenderer":5}],7:[function(e,a,t){var r=e("./DataRenderer");function n(e,a,t,n){r.call(this,e,a,t,n),this.mapFile=this.settings.mapFile,this.lastP=-1,this.seed=1,this.meshes=[],this.renderModels=function(e,a,t){var n;n=this.settings&&this.settings.visible?new THREE.MeshNormalMaterial({side:THREE.DoubleSide}):new THREE.MeshBasicMaterial({visible:!1}),this.parseAllModels(e,n,a,200,0,t)},this.getCollisionsForAnimation=function(e,a){for(var t=[],n=0;n<e.collisionIndices.length;n++){var r=e.collisionIndices[n],i=a[r];i.index=r,t.push(i)}return t},this.parseAllModels=function(e,a,t,n,r,i){for(var o=r;o<r+n&&o<e.length;o++){var s=Math.round(100*o/e.length);s!=this.lastP&&(this.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Collision Models ("+t+")",s),this.lastP=s);for(var l=this.animationFromGeomIndex(e[o].geometryIndex,this.geometries,this.animations),d=this.getCollisionsForAnimation(l,this.havokChunkData.collisions),f=0;f<d.length;f++){var m=d[f];this.renderMesh(m,e[o],a)}}o<e.length?window.setTimeout(this.parseAllModels.bind(this,e,a,t,n,r+n,i),10):i()},this.animationFromGeomIndex=function(e,a,t){var n=a[e].animations.length;return t[a[e].animations[n-1]]},this.renderMesh=function(e,a,t){var n=a.translate,r=a.rotate,i=32*a.scale,o=this.parseHavokMesh(e,t);o.position.set(n[0],-n[2],-n[1]),i&&o.scale.set(i,i,i),r&&(o.rotation.order="ZXY",o.rotation.set(r[0],-r[2],-r[1])),this.getOutput().meshes.push(o)},this.seedRandom=function(){var e=1e4*Math.sin(this.seed++);return e-Math.floor(e)},this.parseHavokMesh=function(e,a){var t=e.index;if(this.meshes[t])return this.meshes[t].clone();for(var n=new THREE.Geometry,r=0;r<e.vertices.length;r++){var i=e.vertices[r];n.vertices.push(new THREE.Vector3(i[0],i[2],-i[1]))}for(r=0;r<e.indices.length;r+=3){var o=e.indices[r],s=e.indices[r+1],l=e.indices[r+2];o<=e.vertices.length&&s<=e.vertices.length&&l<=e.vertices.length?n.faces.push(new THREE.Face3(o,s,l)):this.logger.log(T3D.Logger.TYPE_ERROR,"Errorus index in havok model geometry.")}return n.computeFaceNormals(),this.meshes[t]=new THREE.Mesh(n,a),this.meshes[t]}}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(e){var a=this;this.havokChunkData=this.mapFile.getChunk("havk").data,this.getOutput().boundingBox=this.havokChunkData.boundsMax,this.meshes=[],this.getOutput().meshes=[];var t=this.havokChunkData.propModels,n=this.havokChunkData.zoneModels,r=this.havokChunkData.obsModels;r.forEach(function(e){e.scale=1}),this.geometries=this.havokChunkData.geometries,this.animations=this.havokChunkData.animations;var i=function(){a.renderModels(r,"obs",e)};a.renderModels(t,"prop",function(){a.renderModels(n,"zone",i)})},a.exports=n},{"./DataRenderer":5}],8:[function(e,a,t){var o=e("../util/RenderUtils"),r=e("./DataRenderer");function n(e,a,t,n){r.call(this,e,a,t,n)}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(n){var r=this,e=this.settings.id,i={};r.getOutput().meshes=[],o.getMeshesForFilename(e,65280,r.localReader,i,{},!0,function(e,a,t){e&&e.forEach(function(e){e.boundingSphere=t,r.getOutput().meshes.push(e)}),i={},n()})},a.exports=n},{"../util/RenderUtils":20,"./DataRenderer":5}],9:[function(e,a,t){var l=e("../util/RenderUtils"),r=e("./DataRenderer");function n(e,a,t,n){r.call(this,e,a,t,n),this.mapFile=this.settings.mapFile}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(t){var u=this;u.getOutput().meshes=[];var e=this.mapFile.getChunk("prp2").data;if(e){var n=e.propArray,a=e.propAnimArray,r=e.propInstanceArray,i=e.propMetaArray;n=n.concat(a).concat(r).concat(i),u.meshCache={},u.textureCache={};var o=-1,h=function(d){if(d>=n.length)return u.meshCache={},u.textureCache={},void t();var e=Math.round(1e3*d/n.length);if(o!=(e/=10)){var a=e+(e.toString().indexOf(".")<0?".0":"");u.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Props)",a),o=e}var f=n[d],m=function(e,a,t,n,r){var i=0!=n.lod2?n.lod2:e.lodOverride[1];if(0==e.flags&&(i=0),r&&(e=new THREE.Mesh(e.geometry,e.material)),e.updateMatrix(),e.matrixAutoUpdate=!1,a[i])a[i].add(e);else{var o=new THREE.Group;o.updateMatrix(),o.matrixAutoUpdate=!1,o.add(e),a[i]=o,t.addLevel(o,i)}return i};l.getMeshesForFilename(f.filename,f.color,u.localReader,u.meshCache,u.textureCache,!1,function(e,a,t){var r,n,i,o,s,l;e&&(r=e,n=a,i=t,o={},s=new THREE.LOD,l=0,r.forEach(function(e){l=Math.max(l,m(e,o,s,f,n))}),f.rotation&&(s.rotation.order="ZXY",s.rotation.set(f.rotation[0],-f.rotation[2],-f.rotation[1])),s.scale.set(f.scale,f.scale,f.scale),s.position.set(f.position[0],-f.position[2],-f.position[1]),s.boundingSphereRadius=(i&&i.radius?i.radius:1)*f.scale,s.updateMatrix(),s.matrixAutoUpdate=!1,u.getOutput().meshes.push(s),f.transforms&&f.transforms.forEach(function(e){var a={},t=new THREE.LOD,n=0;r.forEach(function(e){n=Math.max(n,m(e,a,t,f,!0))}),e.rotation&&(t.rotation.order="ZXY",t.rotation.set(e.rotation[0],-e.rotation[2],-e.rotation[1])),t.scale.set(e.scale,e.scale,e.scale),t.position.set(e.position[0],-e.position[2],-e.position[1]),t.updateMatrix(),t.matrixAutoUpdate=!1,t.boundingSphereRadius=(i&&i.radius?i.radius:1)*f.scale,u.getOutput().meshes.push(t)})),h(d+1)})};h(0)}else renderCallback()},n.prototype.getFileIdsAsync=function(t){var n=[],e=this.mapFile.getChunk("prp2").data,r=e.propArray,a=e.propAnimArray,i=e.propInstanceArray,o=e.propMetaArray;r=r.concat(a).concat(i).concat(o);var s=function(a){if(a>=r.length)t(n);else{a%100==0&&this.logger.log(T3D.Logger.TYPE_MESSAGE,"getting ids for entry",a,"of",r.length);var e=r[a];l.getFilesUsedByModel(e.filename,localReader,function(e){n=n.concat(e),s(a+1)})}};s(0)},a.exports=n},{"../util/RenderUtils":20,"./DataRenderer":5}],10:[function(e,a,t){e("../util/RenderUtils");var r=e("./DataRenderer");function n(e,a,t,n){r.call(this,e,a,t,n)}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(s){var l=this;this.settings.id;this.getOutput().strings=[],this.localReader.loadFile(this.settings.id,function(e){var a=new DataStream(e),t=a.byteLength-2;a.seek(4);for(var n=["size","uint16","decryptionOffset","uint16","bitsPerSymbol","uint16"],r=0;6<t-a.position;){var i=a.readStruct(n);if(i.size-=6,0<i.size)if(!(0!=i.decryptionOffset||16!=i.bitsPerSymbol)){var o=a.readUCS2String(i.size/2);l.getOutput().strings.push({value:o,recid:r})}r++}a.seek(a.byteLength-2),l.getOutput().language=a.readUint16(),s()})},a.exports=n},{"../util/RenderUtils":20,"./DataRenderer":5}],11:[function(e,a,t){var z=e("../util/RenderUtils"),i=e("./DataRenderer"),d=e("../format/file/GW2File.js");function n(e,a,t,n,r){i.call(this,e,a,t,n,r),this.mapFile=this.settings.mapFile,this.drawWater=function(e){var a=a||new THREE.MeshBasicMaterial({color:6009320,wireframe:!1,opacity:.35});return a.transparent=!0,z.renderRect(e,0,a)},this.parseNumChunks=function(e){e.numChunksD_1=Math.sqrt(e.dims[0]*e.chunkArray.length/e.dims[1]),e.numChunksD_2=e.chunkArray.length/e.numChunksD_1},this.loadPagedImageCallback=function(n,e){var b=this;b.getOutput().terrainTiles=[];var a=new DataStream(e),t=new d(a,0).getChunk("pgtb"),r=t&&t.data;this.mapRect=null;var S=this.mapFile.getChunk("trn").data,C=this.mapFile.getChunk("parm").data,L=this.settings.anisotropy?this.settings.anisotropy:1;this.parseNumChunks(S);var P=S.numChunksD_1,i=S.numChunksD_2,H=S.materials.materials,U=S.materials.texFileArray,o=C.rect[2]-C.rect[0],s=C.rect[3]-C.rect[1],I=o/S.numChunksD_1*1,O=s/S.numChunksD_2*1,_=0,G=[],B=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:6710886,shading:THREE.FlatShading}),W={};r&&r.strippedPages.forEach(function(e){if(e.layer<=1){var a=e.filename,t=(e.solidColor,e.coord),n=t[0]+","+t[1];if(1==e.layer&&(n+="-2"),!W[n]){var r=z.loadLocalTexture(b.localReader,a);r&&(r.anisotropy=L,r.wrapT=r.wrapS=THREE.RepeatWrapping),W[n]=r}}});var l=function(e,a){if(P<=e&&(e=0,a++),i<=a)return b.getOutput().water=b.drawWater(b.mapRect),b.getOutput().bounds=b.mapRect,void n();var t=Math.floor(100*(a*P+e)/(P*i));b.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Terrain",t),function(e,a){for(var t,n=a*P+e,r=Math.floor(e/4),i=Math.floor(a/4),o=H[n].loResMaterial.texIndexArray,s=(H[n].loResMaterial.materialFile,S.chunkArray[n],U[o[0]],e%4/4),l=.75-a%4/4,d=[],f=0;f<o.length/2;f++){var m=U[o[f]].filename;if(d.push(m),!W[m]){var u=z.loadLocalTexture(b.localReader,m);u&&(u.anisotropy=L,u.wrapT=u.wrapS=THREE.RepeatWrapping),W[m]=u}}var h=r+","+i,c=r+","+i+"-2",g={color:{r:1,g:1,b:1},near:0,far:0},p=b.getOutput(T3D.EnvironmentRenderer);p.hazeColor&&(g.color.r=p.hazeColor[2]/255,g.color.g=p.hazeColor[1]/255,g.color.b=p.hazeColor[0]/255);var v=THREE.UniformsUtils.merge([THREE.UniformsLib.lights]);v.fogColor={type:"v3",value:new THREE.Vector3(g.color.r,g.color.g,g.color.b)},v.fogNear={type:"f",value:g.near},v.fogFar={type:"f",value:g.far},v.uvScale={type:"v2",value:new THREE.Vector2(8,8)},v.offset={type:"v2",value:new THREE.Vector2(s,l)},v.texturePicker={type:"t",value:W[h]},v.texturePicker2={type:"t",value:W[c]},v.texture1={type:"t",value:W[d[0]]},v.texture2={type:"t",value:W[d[1]]},v.texture3={type:"t",value:W[d[2]]},v.texture4={type:"t",value:W[d[3]]},t=new THREE.ShaderMaterial({uniforms:v,vertexShader:"varying vec2 vUv;\r\nvarying vec3 vecNormal;\r\nvoid main()\r\n{\r\nvUv =  uv;\r\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\nvecNormal = (modelMatrix * vec4(normal, 0.0)).xyz;\r\ngl_Position = projectionMatrix * mvPosition;\r\n}",fragmentShader:"\r\nuniform vec3 fogColor;\r\nuniform float fogNear;\r\nuniform float fogFar;\r\nuniform vec2 uvScale;\r\nuniform vec2 offset;\r\nuniform sampler2D texturePicker;\r\nuniform sampler2D texturePicker2;\r\nuniform sampler2D texture1;\r\nuniform sampler2D texture2;\r\nuniform sampler2D texture3;\r\nuniform sampler2D texture4;\r\nuniform vec3 ambientLightColor;\r\n#if MAX_DIR_LIGHTS > 0\r\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\r\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\r\n#endif\r\nvarying vec2 vUv;\r\nvarying vec3 vecNormal;\r\nvec3 blend(\r\nvec4 texture1, float a1,\r\nvec4 texture2, float a2,\r\nvec4 texture3, float a3,\r\nvec4 texture4, float a4)\r\n{\r\nfloat depth = 2.0;\r\nfloat alphaMult = 1.0;\r\nfloat alphaAdd  = 0.0;\r\na1 *= 4.0;\r\na2 *= 4.0;\r\na3 *= 4.0;\r\na4 *= 4.0;\r\na1 =  a1+(1.5+texture1.a);\r\na2 =  a2+(1.5+texture2.a);\r\na3 =  a3+(1.5+texture3.a);\r\na4 =  a4+(1.5+texture4.a);\r\nfloat ma = max(a1,a2);\r\nma = max(ma,a3);\r\nma = max(ma,a4);\r\nma -= depth;\r\nfloat b1 = max(a1 - ma, 0.0);\r\nfloat b2 = max(a2 - ma, 0.0);\r\nfloat b3 = max(a3 - ma, 0.0);\r\nfloat b4 = max(a4 - ma, 0.0);\r\nreturn (\r\ntexture1.rgb * b1 +\r\ntexture2.rgb * b2 +\r\ntexture3.rgb * b3 +\r\ntexture4.rgb * b4 \r\n) / (b1 + b2 + b3 +b4);\r\n}\r\nvoid main( void ) {\r\nvec2 position = vUv*uvScale;\r\nfloat edge = 1.0/1024.0;\r\nvec2 compPos = edge +  (vUv*0.25 + offset)*(1.0-edge*2.0);\r\nvec4 tp1 = texture2D( texturePicker, compPos);\r\nvec4 tp2 = texture2D( texturePicker2, compPos);\r\nvec4 composite = tp1;\r\nvec4 t1 = texture2D( texture1, position );\r\nvec4 t2 = texture2D( texture2, position );\r\nvec4 t3 = texture2D( texture3, position );\r\nvec4 t4 = texture2D( texture4, position );\r\nvec3 color = blend(\r\nt1, tp1.a,\r\nt2, tp1.b,\r\nt3, tp1.g,\r\nt4, tp1.r\r\n);\r\ncolor *= 0.5+tp2.r;\r\ngl_FragColor = vec4(color,1.0);\r\nvec4 addedLights = vec4(ambientLightColor, 1.0);\r\n#if MAX_DIR_LIGHTS > 0\r\nfor(int l = 0; l < MAX_DIR_LIGHTS; l++) {\r\naddedLights.rgb += clamp(\r\ndot(-directionalLightDirection[l], vecNormal),\r\n0.0,\r\n1.0\r\n)\r\n* directionalLightColor[l];\r\n}\r\n#endif\r\ngl_FragColor *= addedLights;\r\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\r\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\r\ngl_FragColor.xyz = mix( gl_FragColor.xyz, fogColor.xyz, fogFactor );\r\n}",lights:!0}),G.push(t);for(var y=new THREE.PlaneBufferGeometry(I,O,32,32),E=0,N=0;N<35;N++)for(var R=0;R<35;R++)0!=R&&34!=R&&0!=N&&34!=N&&(y.attributes.position.array[3*E+2]=S.heightMapArray[_],E++),_++;var T,M=(new THREE.Matrix4).identity();M.elements[5]=-1,y.applyMatrix(M),y.computeFaceNormals(),T=new THREE.Mesh(y,B),(T=t.length?THREE.SceneUtils.createMultiMaterialObject(y,t):new THREE.Mesh(y,t)).rotation.set(Math.PI/2,0,0);var x=C.rect[0]+I/2,F=e*I;if(T.position.x=x+F,S.numChunksD_2%2==0){var w=C.rect[1]+O/2-0,D=a*O*1;T.position.z=D+w}else w=C.rect[1]-O/2+0,D=a*O*1,T.position.z=w+D;var A=T.position.x,k=T.position.z;b.mapRect||(b.mapRect={x1:A-I/2,x2:A+I/2,y1:k-O/2,y2:k+O/2}),b.mapRect.x1=Math.min(b.mapRect.x1,A-I/2),b.mapRect.x2=Math.max(b.mapRect.x2,A+I/2),b.mapRect.y1=Math.min(b.mapRect.y1,k-O/2),b.mapRect.y2=Math.max(b.mapRect.y2,k+O/2),T.updateMatrix(),T.updateMatrixWorld(),b.getOutput().terrainTiles.push(T)}(e,a),setTimeout(l,1,e+1,a)};l(0,0)}}((n.prototype=Object.create(i.prototype)).constructor=n).prototype.renderAsync=function(e){var a=this.mapFile.getChunk("trn").data.materials.pagedImage;this.localReader.loadFile(a,this.loadPagedImageCallback.bind(this,e))},n.prototype.getFileIdsAsync=function(e){var a=this.mapFile.getChunk("trn"),t=this.mapFile.getChunk("pimg"),n=[];return(t&&t.data).strippedPages.forEach(function(e){e.layer<=1&&0<e.filename&&n.push(e.filename)}),a.data.materials.texFileArray.forEach(function(e){0<e.filename&&n.push(e.filename)}),n},a.exports=n},{"../format/file/GW2File.js":16,"../util/RenderUtils":20,"./DataRenderer":5}],12:[function(e,a,t){var l=e("../util/RenderUtils"),r=e("./DataRenderer");function n(e,a,t,n){r.call(this,e,a,t,n),this.mapFile=this.settings.mapFile,this.renderZone=function(a,e,t,r){var i=this,n=null;e.forEach(function(e){n||e.token!=a.defToken||(n=e)});var o=this.getModelGroups(a,n,t);i.meshCache={},i.textureCache={};var s=Object.keys(o);!function t(n){if(n>=s.length)return i.meshCache={},i.textureCache={},void r();var e=s[n],R=o[e],T=[];l.getMeshesForFilename(e,null,i.localReader,i.meshCache,i.textureCache,!1,function(e,a){e&&R.forEach(function(E,N){e.forEach(function(e,a){if(525!=e.materialFlags){var t={x:0,y:0,z:0};if(T[a])t.x=E.x-T[a].position.x,t.y=E.z-T[a].position.z,t.z=E.y-T[a].position.y;else{var n=e.geometry.clone().attributes;T[a]={readVerts:n.position.array,verts:new Float32Array(R.length*n.position.array.length),readIndices:n.index.array,indices:new Uint32Array(R.length*n.index.array.length),readUVs:n.uv.array,uvs:new Float32Array(R.length*n.uv.array.length),readNormals:n.normal.array,normals:new Float32Array(R.length*n.normal.array.length),material:e.material,position:{x:E.x,y:E.y,z:E.z}}}for(var r=T[a].readVerts,i=T[a].verts,o=r.length,s=0,l=N*o;s<o;s+=3,l+=3)i[l+0]=r[s+0]+t.x,i[l+1]=r[s+1]+t.y,i[l+2]=r[s+2]+t.z;var d=T[a].readIndices,f=T[a].indices,m=d.length,u=o*N/3;for(s=0,l=N*m;s<m;s++,l++)f[l]=d[s]+u;var h=T[a].readUVs,c=T[a].uvs,g=h.length;for(s=0,l=N*g;s<g;s++,l++)c[l]=h[s];var p=T[a].readNormals,v=T[a].normals,y=p.length;for(s=0,l=N*y;s<y;s++,l++)v[l]=p[s]}})}),T.forEach(function(e){var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(e.verts,3)),a.addAttribute("index",new THREE.BufferAttribute(e.indices,1)),a.addAttribute("normal",new THREE.BufferAttribute(e.normals,3)),a.addAttribute("uv",new THREE.BufferAttribute(e.uvs,2)),a.buffersNeedUpdate=!0,mesh=new THREE.Mesh(a,e.material),mesh.position.set(e.position.x,e.position.z,e.position.y),i.getOutput().meshes.push(mesh)}),t(n+1)})}(0)},this.getModelGroups=function(e,a,t){e.zPos;var n=t[0],r=t[1],i=48*e.vertRect[0]+n,o=(e.vertRect[2],-48*e.vertRect[1]-r);e.vertRect[3];if(0==e.encodeData.length)return{};for(var s=e.vertRect[0]-e.vertRect[2],l=(e.vertRect[1],e.vertRect[3],0),d={},f=this.getOutput(T3D.TerrainRenderer).terrainTiles,m=0;m<e.flags.length;m+=2){l+=e.flags[m];var u=e.flags[m+1];if(0!=u){var h=u>>4,c=a.layerDefArray[h-1];if(c){var g=l%s*48+i,p=48*Math.floor(l/s)+o,v=null,y=new THREE.Raycaster(new THREE.Vector3(g,1e5,p),new THREE.Vector3(0,-1,0));f.forEach(function(e){if(null===v){var a=y.intersectObject(e);0<a.length&&(v=1e5-a[0].distance)}});var E=c.modelArray[0],N=E.filename,R=(E.zOffsets,c.layerFlags,c.rotRangeX),T=c.rotRangeY,M=c.rotRangeZ,x=c.scaleRange,F=c.fadeRange;d[N]||(d[N]=[]),d[N].push({x:g,y:p,z:v,rotRangeX:R,rotRangeY:T,rotRangeZ:M,scaleRange:x,fadeRange:F})}}}return d}}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(n){var r=this;r.getOutput().meshes=[];var e=this.mapFile.getChunk("zon2").data,a=this.mapFile.getChunk("parm").data,i=(this.mapFile.getChunk("trn").data,a.rect),o=e.zoneArray,s=e.zoneDefArray;lastPct=-1,function e(a){var t=Math.round(100*a/o.length);lastPct!=t&&(r.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Zone)",t),lastPct=t),a>=o.length?n():r.renderZone(o[a],s,i,e.bind(r,a+1))}(0)},a.exports=n},{"../util/RenderUtils":20,"./DataRenderer":5}],13:[function(e,a,t){a.exports=["version","uint8","magic","string:3","headerSize","uint32","unknown1","uint32","chunkSize","uint32","crc","uint32","unknown2","uint32","mftOffset",["[]","uint32",2],"mftSize","uint32","flags","uint32"]},{}],14:[function(e,a,t){a.exports=["magic","string:4","unknown1",["[]","uint32",2],"nbOfEntries","uint32","unknown2","uint32","unknown3","uint32"]},{}],15:[function(e,a,t){var n=["type","cstring:4","chunkDataSize","uint32","chunkVersion","uint16","chunkHeaderSize","uint16","offsetTableOffset","uint32"],o={ANIM:["MODL","Unknown"],GAME:["MODL","Unknown"],Main:["cntc","mMet"],SKEL:["MODL","Unknown"],TOOL:["AMAT","MODL"],main:["Unknown","Unknown","cmaC"],nvms:["Unknown","Unknown"]},r=function(e,a){this.ds=e,this.addr=a,this.data=null,this.headerLength=NaN,this.loadHead()};r.prototype.loadHead=function(){this.ds.seek(this.addr),this.header=this.ds.readStruct(n),this.headerLength=this.ds.position-this.addr},r.prototype.getDefinition=function(e){var a=0,t=o[this.header.type];if(t){a=-1;for(var n=0;n<t.length&&-1==a;n++){t[n]==e&&(a=n)}}var r=0;for(n=0;n<T3D.formats.length;n++){var i=T3D.formats[n];if(i.name==this.header.type){if(r==a&&i.versions[this.header.chunkVersion])return(new i.versions[this.header.chunkVersion]).__root;r++}}},r.prototype.loadData=function(e){var a=this.getDefinition(e);a?(this.ds.seek(this.addr+this.headerLength),this.data=this.ds.readStruct(a)):T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Could not find a definition for chunk",this.header.type,"version",this.header.chunkVersion,"file name",e)},r.prototype.next=function(){try{return new r(this.ds,this.addr+8+this.header.chunkDataSize)}catch(e){}return null},a.exports=r},{}],16:[function(e,a,t){var n=e("./GW2Chunk"),r=["identifier","cstring:2","unknownField1","uint16","unknownField2","uint16","pkFileVersion","uint16","type","cstring:4"],i=function(e,a,t){this.ds=e,this.addr=a,this.data=null,this.headerLength=NaN,this.chunks=[],this.readHead(),t||this.readChunks()};i.prototype.readHead=function(){this.ds.seek(this.addr),this.header=this.ds.readStruct(r),this.headerLength=this.ds.position-this.addr},i.prototype.readChunks=function(){this.chunks=[];for(var e=new n(this.ds,this.headerLength+this.addr);null!=e&&e.header.type;)e.loadData(this.header.type),this.chunks.push(e),e=e.next()},i.prototype.getChunk=function(e){for(var a=0;a<this.chunks.length;a++)if(this.chunks[a].header.type.toLowerCase()==e.toLowerCase())return this.chunks[a];return null},i.prototype.getChunkStructs=function(){return{}},a.exports=i},{"./GW2Chunk":15}],17:[function(e,a,t){var n=a.exports={};n.getMaterial=function(e,a,n,r){if(a){var t,i=a.getChunk("dx9s"),o=a.getChunk("grmt"),s=[];if(e&&e.textures.length){for(var l=i.data.techniques[0].passes[0].effects[0],d=(i.data.shaders[l.pixelShader],[]),f=0;f<l.samplerIndex.length;f++){var m=l.samplerIndex[f],u=i.data.samplers[m];if(u){var h=u&&o.data.texTokens[u.textureIndex];h||(h="0-0");var c=null;if(e.textures.forEach(function(e,a){c||e.token.split("-")[0]!=h.split("-")[0]||(c=e)}),c)d.push(c);else if(u)d.push(e.textures[u.textureIndex]);else{if(!(0<e.textures.length))return;d.push(e.textures[0])}}}if(d.length<=0)return;d.forEach(function(e,a){if(e){var t=e&&e.filename;s[a]=p(t,n,r),s[a]&&(s[a].uvIdx=e.uvPSInputIndex)}})}if(s){var g=!1;if(e.textures.forEach(function(e){g||"1733499172"!=e.token.split("-")[0]||(g=e)}),!g||g.filename<=0)return;(t=new THREE.MeshLambertMaterial({side:THREE.BackSide,map:p(g.filename,n,r)})).textureFilename=g.filename,16460!=o.data.flags&&(t.alphaTest=.05)}else t=new THREE.MeshBasicMaterial({side:THREE.BackSide,color:16711680,shading:THREE.FlatShading});if(t.needsUpdate=!0,e){o=a.getChunk("grmt");1&e.materialFlags||16&e.materialFlags||e.materialFlags;[16460,16452,16448,8268,3392,2380,2368,332,324,320,76,68,64].indexOf(o.data.flags)<0&&T3D.Logger.log(T3D.Logger.TYPE_WARNING,"unknown GR flag",o.data.flags),8&o.data.flags||(t=new THREE.MeshBasicMaterial({side:THREE.BackSide,map:t.map})),16460!=o.data.flags&&(t.alphaTest=.05)}return t}};var p=n.getTexture=function(e,a,t){var n;return e&&t[e]?n=t[e]:e&&((n=r(a,e)).wrapT=THREE.RepeatWrapping,n.wrapS=THREE.RepeatWrapping,n.flipY=!1,t[e]=n),n},r=n.loadLocalTexture=function(e,a,t,n,i){void 0===n&&(n=Math.floor(16777215*Math.random()));var o=THREE.ImageUtils.generateDataTexture(1,1,new THREE.Color(n));return parseInt(a)<=0?i&&i():e.loadTextureFile(a,function(e,a,t,n){if(e){var r={data:new Uint8Array(e),width:t,height:n};o.format=THREE.RGBAFormat,o.image=r,o.needsUpdate=!0}else i&&i()}),o}},{}],18:[function(e,a,t){var n=a.exports={};n.f16=function(e){var a=(32768&e)>>15,t=(31744&e)>>10,n=1023&e;return 0==t?(a?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):31==t?n?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))},n.popcount=function(e){var a=858993459,t=252645135;return e=((e=((e-=e>>1&1431655765)&a)+(e>>2&a))&t)+(e>>4&t),(e+=e>>8)+(e>>15)&63};var r=Math.pow(2,32);n.arr32To64=function(e){return r*e[1]+e[0]},n.sort_unique=function(e,a){for(var t=Array.prototype.sort.call(e,a),n={},r=[],i=0,o=t.length;i<o;++i)n.hasOwnProperty(t[i])||(r.push(t[i]),n[t[i]]=1);return r}},{}],19:[function(e,a,t){a.exports={getArrayReader:function(s,l){return function(e,a){var t=[];try{var n=e.readUint32(),r=e.readUint32();if(0==r)return t;var i=e.position-4+r,o=e.position;if(l&&l<n)throw"Array length "+n+" exceeded allowed maximum "+l;o=e.position;e.seek(i),t=e.readType(["[]",s,n],a),e.seek(o)}catch(e){console.warn("getArrayReader Failed loading array",e),console.warn("getArrayReader Failed loading array, structDef",s)}return t}},getRefArrayReader:function(f){return function(e,a){var t=[],n=e.readUint32(),r=e.position+e.readUint32();if(0==n)return t;var i=e.position;e.seek(r);var o=e.readInt32Array(n),s=i-4;e.seek(s),s+=e.readUint32();for(var l=0;l<o.length;l++)if(0!=o[l]){var d=s+4*l+o[l];e.seek(d);try{t.push(e.readStruct(f))}catch(e){t.push(null),console.warn("getRefArrayReader could not find refered data at offset",o[l],e)}}return e.seek(i),t}},getQWordReader:function(){return function(e,a){return e.readUint32()+"-"+e.readUint32()}},getStringReader:function(){return function(e,a){var t=e.position+e.readUint32(),n=e.position;e.seek(t);var r=e.readCString();return e.seek(n),r}},getString16Reader:function(o){return function(e,a){var t=e.position+e.readUint32()+(o||0),n=e.position;e.seek(t);for(var r,i="";e.position+2<e.byteLength&&0!=(r=e.readUint16());)i+=String.fromCharCode(r);return e.seek(n),i}},getPointerReader:function(o){return function(e,a){var t=e.readUint32();if(0==t)return{};var n=e.position-4+t,r=e.position;e.seek(n);var i=e.readStruct(o);return e.seek(r),i}},getFileNameReader:function(){return function(a,e){try{var t=a.position+a.readUint32(),n=a.position;a.seek(t);var r=a.readStruct(["m_lowPart","uint16","m_highPart","uint16","m_terminator","uint16"]),i=65280*(r.m_highPart-256)+(r.m_lowPart-256)+1;return i<0&&(i=0),a.seek(n),i}catch(e){return a.seek(n),-1}}}}},{}],20:[function(e,a,t){var g=e("../format/file/GW2File"),O=e("./MaterialUtils"),_=e("./MathUtils"),G={},B=1,W=2,z=4,Y=8,j=16,V=32,q=64,X=128,K=65280,Z=16711680,n=a.exports={},p=(n.renderRect=function(e,a,t,n){var r=e.x1-e.x2,i=e.y1-e.y2;n||(n=1);var o=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2,l=a,d=new THREE.BoxGeometry(r,n,i);t=t||new THREE.MeshBasicMaterial({color:16711680,wireframe:!0});var f=new THREE.Mesh(d,t);return f.overdraw=!0,f.position.x=o,f.position.y=l,f.position.z=s,f},n.loadLocalTexture=function(e,a,t,n,r){return O.loadLocalTexture(e,a,t,n,r)},n.renderGeomChunk=function(C,e,L,P,H){var a=e.data.meshes,U=[],I=L.data.permutations[0].materials;return a.forEach(function(e){var a=e.geometry,t=a.verts.mesh.fvf,n=a.verts.vertexCount,r=a.verts.mesh.vertices,i=a.indices.indices,o=new THREE.BufferGeometry,s=new DataStream(r.buffer),l=r.length/n,d=new Float32Array(3*n),f=[],m=12*!!(t&B)+4*!!(t&W)+4*!!(t&z)+12*!!(t&Y)+4*!!(t&j)+12*!!(t&V)+12*!!(t&q)+12*!!(t&X),u=(t&K)>>8,h=(t&Z)>>16,c=!!u,g=!!h||!!u,p=c?u:h,v=_.popcount(p);if(v=Math.min(v,1),g)for(var y=0;y<v;y++)f[y]=new Float32Array(2*n);for(y=0;y<n;y++){s.seek(y*l);var E=s.readFloat32(),N=s.readFloat32(),R=s.readFloat32();if(d[3*y+0]=E,d[3*y+1]=-R,d[3*y+2]=-N,g)for(var T=0;T<v;T++){var M,x;s.seek(y*l+m+T*(c?8:4)),c?(M=s.readUint32(),x=s.readUint32()):(M=_.f16(s.readUint16()),x=_.f16(s.readUint16())),f[T][2*y+0]=M,f[T][2*y+1]=x}}var F=new Uint16Array(i.length);for(y=0;y<i.length;y+=3)F[y+0]=i[y+0],F[y+1]=i[y+1],F[y+2]=i[y+2];if(o.addAttribute("position",new THREE.BufferAttribute(d,3)),o.addAttribute("index",new THREE.BufferAttribute(F,1)),o.computeVertexNormals(),g){for(T=0;T<v;T++){var w="uv"+(0<T?T+1:"");o.addAttribute(w,new THREE.BufferAttribute(f[T],2)),o.attributes[w].needsUpdate=!0}o.uvsNeedUpdate=!0}o.buffersNeedUpdate=!0;var D=e.materialIndex,A=I[D],k=null;A&&G[A.filename]&&(k=G[A.filename]);var b=O.getMaterial(A,k,C,P);if(!b){if(!H)return;b=new THREE.MeshLambertMaterial({color:6009320,wireframe:!1,side:THREE.DoubleSide})}var S=new THREE.Mesh(o,b);A&&(S.materialFlags=A.materialFlags,S.materialFilename=A.filename),S.materialName=e.materialName,S.numLods=e.geometry.lods.length,S.lodOverride=L.data.lodOverride,S.flags=e.flags,S.numUV=v,U.push(S)}),U}),s=n.loadMeshFromModelFile=function(d,e,f,m,u,h){var c=[];f.loadFile(d,function(e){try{if(!e)throw"Could not find MFT entry for "+d;var a=new DataStream(e),t=new g(a,0),n=t.getChunk("modl"),r=t.getChunk("geom"),i=n.data.boundingSphere,o=i.center;i.radius+=Math.sqrt(o[0]*o[0]+Math.sqrt(o[1]*o[1]+o[2]*o[2]));var s=n.data.permutations[0].materials;!function n(r,i){if(r>=s.length)i();else{var o=s[r];G[o.filename]?n(r+1,i):f.loadFile(o.filename,function(e){if(e){var a=new DataStream(e),t=new g(a,0);G[o.filename]=t}n(r+1,i)})}}(0,function(){p(f,r,n,m,u).forEach(function(e){[0,8,9,520,2056,2057,2060,2061,2312,2316,2568,2569,2572,2573,2584,2824,2828,2840,4617,6664].indexOf(e.materialFlags),e.materialFlags,(u||2056&e.materialFlags)&&(4==e.flags||1==e.flags||e.flags,c.push(e))}),h(c,i)})}catch(e){console.warn("Failed rendering model "+d,e);var l=new THREE.Mesh(new THREE.BoxGeometry(200,2e3,200),new THREE.MeshNormalMaterial);l.flags=4,l.materialFlags=2056,l.lodOverride=[1e6,1e6],c.push(l),h(c)}})};n.getMeshesForFilename=function(t,e,a,n,r,i,o){n[t]?o(n[t].meshes,!0,n[t].boundingSphere):s(t,e,a,r,i,function(e,a){e&&(n[t]={meshes:e,boundingSphere:a}),o(e,!1,a)})},n.getFilesUsedByModel=function(t,e,n){var r=[t];e.loadFile(t,function(e){try{if(!e)throw"Could not find MFT entry for "+t;var a=new DataStream(e);new g(a,0).getChunk("modl").data.permutations[0].materials.forEach(function(e){var a=e.filename;r.push(a),e.textures.forEach(function(e){r.push(e.filename)})})}catch(e){console.warn("Could not export any data",e)}n(r)})}},{"../format/file/GW2File":16,"./MaterialUtils":17,"./MathUtils":18}]},{},[4])(4)});