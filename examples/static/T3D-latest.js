!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).T3D=e()}}(function(){return function(){return function e(t,a,n){function r(o,s){if(!a[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(i)return i(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var m=a[o]={exports:{}};t[o][0].call(m.exports,function(e){return r(t[o][1][e]||e)},m,m.exports,e,t,a,n)}return a[o].exports}for(var i="function"==typeof require&&require,o=0;o<n.length;o++)r(n[o]);return r}}()({1:[function(e,t,a){const n=e("../util/MathUtils");function r(e){let t={};if(t.version=e.readUint8(),t.magic=e.readString(3),t.headerSize=e.readUint32(),e.seek(e.position+4),t.chunkSize=e.readUint32(),t.crc=e.readUint32(),e.seek(e.position+4),t.mftOffset=n.arr32To64([e.readUint32(),e.readUint32()]),t.mftSize=e.readUint32(),t.flags=e.readUint32(),"AN"===t.magic)return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded Main .dat header"),t;T3D.Logger.log(T3D.Logger.TYPE_ERROR,"ANDat header is not valid",t.magic)}function i(e){let t={};if(t.magic=e.readString(4),e.seek(e.position+8),t.nbOfEntries=e.readUint32(),e.seek(e.position+4+4),"Mft"!==t.magic)return void T3D.Logger.log(T3D.Logger.TYPE_ERROR,"MFTTable header is not valid",t.magic);let a=[];for(let r=1;r<t.nbOfEntries;r++){let t={};t.offset=n.arr32To64([e.readUint32(),e.readUint32()]),t.size=e.readUint32(),t.compressed=e.readUint16(),e.seek(e.position+4+2),t.crc=e.readUint32(),a[r]=t}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded MFTTable"),{header:t,table:a,mftIndexOffset:a[2].offset,mftIndexSize:a[2].size}}function o(e,t){let a=t/8,n=[];for(let t=0;t<a;t++){let t=e.readUint32(),a=e.readUint32();n[t]=a}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Finished indexing MFT"),n}function s(e,t,a){return new Promise((n,r)=>{let i=new FileReader;i.onerror=r,i.onload=(e=>{let t=e.target.result,r=new DataStream(t);r.endianness=DataStream.LITTLE_ENDIAN,n({ds:r,len:a})}),i.readAsArrayBuffer(e.slice(t,t+a))})}t.exports={readArchive:async function(e){let t=r((await s(e,0,40)).ds),a=i((await s(e,t.mftOffset,t.mftSize)).ds),{ds:n,len:l}=await s(e,a.mftIndexOffset,a.mftIndexSize),d=o(n,l);return{archiveHeader:t,metaTable:a.table,indexTable:d}},parseANDatHeader:r,parseMFTTable:i,parseMFTIndex:o,getFilePart:s}},{"../util/MathUtils":26}],2:[function(e,t,a){t.exports=class DataReader{constructor(e){this._settings=e,this._workerPool=[],this._workerLoad=[],this._handleCounter=0,this._workQueue=[],this._handleRegister={};for(let t=0;t<e.workersNb;t++)this._startWorker(e.workerPath)}inflate(e,t,a,n,r){return new Promise((i,o)=>{let s=e.buffer;if((!r||r<0)&&(r=0),s.byteLength<12)return T3D.Logger.log(T3D.Logger.TYPE_WARNING,`not inflating, length is too short (${s.byteLength})`,a),void o(new Error("Couldn't inflate "+a+" (mftId)"));this._workQueue.push({buffer:s,size:t,mftId:a,isImage:n,capLength:r,resolve:i,reject:o});const l=this._getFreeWorkerIndex();l>=0&&this._workNext(l)})}_workNext(e){const t=this._workQueue.shift();if(t){const a=this._getNewHandle();this._handleRegister[a]={mftId:t.mftId,workerId:e,resolve:t.resolve,reject:t.reject},this._workerLoad[e]+=1,this._workerPool[e].postMessage([a,t.buffer,!0===t.isImage,t.capLength])}}_getNewHandle(){return this._handleCounter++}_startWorker(e,t){let a,n=new Worker(e);if(t)a=t,this._workerPool[a]=n,this._workerLoad[a]=0;else if(a=this._workerPool.push(n)-1,this._workerLoad.push(0)!==a+1)throw new Error("WorkerLoad and WorkerPool don't have the same length");n.onmessage=(e=>{const t=e.data;let n;if(this._workerLoad[a]-=1,"string"==typeof t){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Inflater threw an error",t),n=t.split(":")[0];const e=this._handleRegister[n];e&&(e.reject(`Error: ${t}`),delete this._handleRegister[n])}else{n=t[0];const e=this._handleRegister[n];e?(e.resolve({buffer:t[1],dxtType:t[2],imageWidth:t[3],imageHeight:t[4]}),delete this._handleRegister[n]):T3D.Logger.log(T3D.Logger.TYPE_ERROR,"Inflater threw an error",t)}this._workNext(a)}),n.onerror=(e=>{for(let e in this._handleRegister)this._handleRegister[e].workerId===a&&(this._handleRegister[e].reject(`Error: Worker crashed while processing ${this._handleRegister[e].mftId}`),delete this._handleRegister[e]);this._workerPool[a].terminate(),this._startWorker(this._settings.workerPath,a)})}_getFreeWorkerIndex(){return this._workerLoad.indexOf(0)}}},{}],3:[function(e,t,a){const n=e("../format/file/GW2File.js");function r(e){let t;return"ATEC"===e?t="TEXTURE_ATEC":"ATEP"===e?t="TEXTURE_ATEP":"ATET"===e?t="TEXTURE_ATET":"ATEU"===e?t="TEXTURE_ATEU":"ATEX"===e?t="TEXTURE_ATEX":"ATTX"===e&&(t="TEXTURE_ATTX"),t}t.exports={getFileType:function(e){let t=e.readCString(4),a="UNKNOWN";const i=r(t);i?a=i:0===t.indexOf("DDS")?a="TEXTURE_DDS":1===t.indexOf("PNG")?a="TEXTURE_PNG":0===t.indexOf("RIFF")?a="TEXTURE_RIFF":0===t.indexOf("YUI")?a="TEXT_YUI":0===t.indexOf("PF")?a="PF_"+new n(e,0,!0).header.type:0===t.indexOf("MZ")?a="BINARIES":0===t.indexOf("strs")?a="STRINGS":0===t.indexOf("asnd")&&(a="CHUNK_ASND");return a},getAnetTextureType:r}},{"../format/file/GW2File.js":18}],4:[function(e,t,a){const n=e("./ArchiveParser"),r=e("./PersistantStore"),i=e("./DataReader"),o=e("../MapFileList"),s=e("./FileTypes");t.exports=class LocalReader{constructor(e){this._settings=e,this._dataReader=new i(e),this._persistantStore=void 0,this._file=void 0,this._indexTable=[],this._fileMetaTable=[],!1!==e.noIndexedDB&&(this._persistantStore=new r)}async openArchive(e){let{metaTable:t,indexTable:a}=await n.readArchive(e);this._fileMetaTable=t,this._indexTable=a,this._file=e}getFileIndex(e){return this._indexTable[e]}getFileMeta(e){return this._fileMetaTable[e]}async readFile(e,t,a,r,i,o){if(o){const t=e;if(!((e=this.getFileIndex(t))>0))throw new Error(`Unexistant file: ${t} (baseId)`)}let s=this.getFileMeta(e);if(!s)throw new Error(`Unexistant file: ${e} (mftId)`);let{ds:l,len:d}=await n.getFilePart(this._file,s.offset,r||s.size);if(s.compressed||!1!==a){let a;return await this._dataReader.inflate(l,d,e,t,i||0).then(e=>{a=e}).catch(e=>{a={buffer:void 0,dxtType:void 0,imageWidth:void 0,imageHeight:void 0}}),a}return{buffer:l.buffer}}async readFileList(e){let t,a=e||[];if(this._persistantStore){let e=await this._persistantStore.getLastListing(this._file.name);a=e.array,e.complete||(t=e.key)}let n=Object.keys(this._indexTable).map(e=>Number(e));for(let e in a)e in this._indexTable||n.push(e);let r=[];for(let e=0;e<1;e++)r[e]=Promise.resolve({task:e});let i=!1;for(let e in n){let o=n[e],s=this._needsScan(o,a);if(!0===s.scan){let e=(await Promise.race(r)).task;r[e]=this.readFileType(o).then(t=>(a[o]={baseId:o,size:t.size,crc:t.crc,fileType:t.fileType},{task:e}))}"removed"===s.change&&delete a[o],"none"!==s.change&&(i=!0),e%Math.floor(n.length/100)==0&&(T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Finding types",e/Math.floor(n.length/100)),this._persistantStore&&i&&(i=!1,this._persistantStore.putListing(t,a,this._file.name,!1).then(e=>t=e)))}return await Promise.all(r).then(()=>{this._persistantStore&&this._persistantStore.putListing(t,a,this._file.name,!0)}),this._persistantData=a,this.getFileList()}getMapList(){let e=[];if(this._persistantData){let t=this.getReverseIndex(),a=this._persistantData.filter(e=>"PF_mapc"===e.fileType).filter(e=>e.baseId===t[this.getFileIndex(e.baseId)][0]);for(let t of a){let a=!1;for(let n of o.maps){let r=n.maps.find(e=>Number(e.fileName.split(".data")[0])===t.baseId);if(r){e.push({name:r.name,category:n.name,baseId:t.baseId}),a=!0;break}}a||e.push({name:t.baseId.toString(),category:"Uncategorized",baseId:t.baseId})}}else for(let t of o.maps)for(let a of t.maps)Number(a.fileName.split(".data")[0])in this._indexTable&&e.push({name:a.name,category:t.name,baseId:Number(a.fileName.split(".data")[0])});return e}getFileList(){let e=this._persistantData?this._persistantData.map(e=>e.fileType):[],t=this.getReverseIndex(),a=this._fileMetaTable.map((a,n)=>{let r=t[n]?t[n]:[],i=t[n]?e[r[0]]:"Non-Registered";return{mftId:n,baseIdList:r,size:a.size,crc:a.crc,fileType:i}});return a[0]={mftId:0,baseIdList:[],size:0,crc:0,fileType:"Non-Registered"},a}getReverseIndex(){return this._indexTable.reduce((e,t,a)=>(t in e?e[t].push(a):e[t]=[a],e),[])}readMapListAsync(e,t){function a(e){let t=[];for(let a of e){let e=t.findIndex(e=>e.name===a.category);-1===e&&(e=t.push({name:a.category,maps:[]})-1),t[e].maps.push({fileName:a.baseId,name:a.name})}return t.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),{maps:t}}T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readMapListAsync is deprecated !"),e?this.readFileList().then(()=>{t(a(this.getMapList()))}):t(a(this.getMapList()))}readFileListAsync(e){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readFileListAsync is deprecated !"),this.readFileList().then(t=>{let a={};for(let e of t)void 0===a[e.fileType]&&(a[e.fileType]=[]),a[e.fileType].push(e.mftId);e(a)})}loadFile(e,t,a,n){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFile is deprecated !"),this.readFile(e,a,n,void 0,void 0,!0).then(e=>{if(void 0===e.buffer)return t(null);t(e.buffer,e.dxtType,e.imageWidth,e.imageHeight)})}loadTextureFile(e,t){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadTextureFile is deprecated !"),this.readFile(e,void 0,void 0,void 0,void 0,!0).then(e=>{if(void 0===e.buffer)return t(null);t(e.buffer,e.dxtType,e.imageWidth,e.imageHeight)})}loadFileList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFileList is deprecated !")}loadMapList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadMapList is deprecated !")}_needsScan(e,t){if(e<=0)return{change:"none",scan:!1};let a=this.getFileIndex(e),n=this.getFileMeta(a);return void 0!==n||e in t?void 0===n?{change:"removed",scan:!1}:e in t?n.size!==t[e].size||n.crc!==t[e].crc?{change:"modified",scan:!0}:{change:"none",scan:!1}:{change:"added",scan:!0}:{change:"none",scan:!1}}async readFileType(e){this._fileTypeCache||(this._fileTypeCache=[]);let t,a=this.getFileIndex(e),n=this.getFileMeta(a);if(void 0!==this._fileTypeCache[e])t=this._fileTypeCache[e];else{let e=(await this.readFile(a,!1,!1,Math.min(n.size,1e3),32)).buffer;if(void 0===e)return;t=s.getFileType(new DataStream(e))}return{fileType:t,crc:n.crc,size:n.size}}}},{"../MapFileList":7,"./ArchiveParser":1,"./DataReader":2,"./FileTypes":3,"./PersistantStore":5}],5:[function(e,t,a){const n=4;t.exports=class PersistantStore{constructor(){this._dbConnection=void 0,this._getConnection(()=>{})}_getConnection(){return new Promise((e,t)=>{this._dbConnection&&e(this._dbConnection);let a=window.indexedDB.open("Tyria3DLibrary",n);a.onblocked=(e=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database cannot be upgraded while the app is opened somewhere else.")}),a.onupgradeneeded=(e=>{let t=e.target.result,a=e.oldVersion;a<2&&t.createObjectStore("listings",{autoIncrement:!0}),a<3&&e.currentTarget.transaction.objectStore("listings").createIndex("filename","filename",{unique:!1})}),a.onsuccess=(t=>{this._dbConnection=t.target.result,this.isReady=!0,e(this._dbConnection)}),a.onerror=(e=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database could not be opened."),t(new Error("IndexedDB failed to open"))})})}putListing(e,t,a,n){return new Promise((r,i)=>{this._getConnection().then(o=>{let s=o.transaction(["listings"],"readwrite").objectStore("listings"),l=e?s.put({array:t,filename:a,complete:n},e):s.put({array:t,name:a});l.onsuccess=(e=>{r(l.result)}),l.onerror=(e=>{i(new Error("Could not put listing to Indexed DB"))})})})}getLastListing(e){return new Promise((t,a)=>{this._getConnection().then(a=>{a.transaction(["listings"],"readonly").objectStore("listings").index("filename").openCursor(IDBKeyRange.only(e),"prev").onsuccess=(e=>{let a=e.target.result;t(a?{array:a.value.array,key:a.primaryKey,complete:a.value.complete}:{array:[],key:void 0,complete:!0})})})})}}},{}],6:[function(e,t,a){let n={TYPE_ERROR:4,TYPE_WARNING:3,TYPE_MESSAGE:2,TYPE_PROGRESS:1,TYPE_DEBUG:0};n.logFunctions=new Array(5),n.log=function(){if(0===arguments.length)return;let e=n.argsToArr(arguments);1===e.length&&e.unshift(n.TYPE_MESSAGE);let t=Math.max(0,Math.min(n.logFunctions.length,e.shift()));n.logFunctions[t].apply(this,e)},n.argsToArr=function(e){let t=new Array(e.length);for(let a=0;a<t.length;++a)t[a]=e[a];return t},n.logFunctions[n.TYPE_ERROR]=function(){console.error.apply(console,arguments)},n.logFunctions[n.TYPE_WARNING]=function(){console.warn.apply(console,arguments)},n.logFunctions[n.TYPE_MESSAGE]=function(){console.log.apply(console,arguments)},n.logFunctions[n.TYPE_PROGRESS]=function(){let e=n.argsToArr(arguments);e.unshift("Progress: "),console.log.apply(console,e)},n.logFunctions[n.TYPE_DEBUG]=function(){let e=n.argsToArr(arguments);console.debug.apply(console,e)},t.exports=n},{}],7:[function(e,t,a){t.exports={maps:[{name:"01. Shiverpeaks",maps:[{fileName:"125199.data",name:"Wayfarer Foothills (0)"},{fileName:"187611.data",name:"Wayfarer Foothills (1)"},{fileName:"568778.data",name:"Cragstead"},{fileName:"132434.data",name:"Hoelbrak (0)"},{fileName:"197122.data",name:"Hoelbrak (1)"},{fileName:"1966018.data",name:"Hoelbrak (2)"},{fileName:"124093.data",name:"Snowden Drifts (0)"},{fileName:"186397.data",name:"Snowden Drifts (1)"},{fileName:"275155.data",name:"Dredgehaunt Cliffs"},{fileName:"276252.data",name:"Frostgorge Sound"},{fileName:"277587.data",name:"Lornar's Pass"},{fileName:"278717.data",name:"Timberline Falls (0)"},{fileName:"846866.data",name:"Timberline Falls (1)"},{fileName:"1018612.data",name:"Timberline Falls (2)"},{fileName:"295282.data",name:"Eye of the North"}]},{name:"02. Ascalon",maps:[{fileName:"126118.data",name:"Plains of Ashford (0)"},{fileName:"188591.data",name:"Plains of Ashford (1)"},{fileName:"127888.data",name:"Diessa Plateau (0)"},{fileName:"190490.data",name:"Diessa Plateau (1)"},{fileName:"131944.data",name:"Black Citadel (0)"},{fileName:"196585.data",name:"Black Citadel (1)"},{fileName:"1968107.data",name:"Black Citadel (2)"},{fileName:"280025.data",name:"Blazeridge Steppes"},{fileName:"281313.data",name:"Fireheart Rise"},{fileName:"282668.data",name:"Iron Marches"},{fileName:"283574.data",name:"Fields of Ruin"}]},{name:"03. Kryta",maps:[{fileName:"191000.data",name:"Lion's Arch (0)"},{fileName:"814803.data",name:"Lion's Arch (1)"},{fileName:"1019669.data",name:"Lion's Arch (Legacy)"},{fileName:"1796999.data",name:"Lion's Arch (2)"},{fileName:"1869665.data",name:"Lion's Arch (3)"},{fileName:"1968576.data",name:"Lion's Arch (4)"},{fileName:"128151.data",name:"Divinity's Reach (0)"},{fileName:"191265.data",name:"Divinity's Reach (1)"},{fileName:"705746.data",name:"Divinity's Reach (2)"},{fileName:"1968748.data",name:"Divinity's Reach (3)"},{fileName:"129834.data",name:"North of Divinity's Reach (0)"},{fileName:"193081.data",name:"North of Divinity's Reach (1)"},{fileName:"129524.data",name:"Queensdale (0)"},{fileName:"192711.data",name:"Queensdale (1)"},{fileName:"130970.data",name:"Kessex Hills (0)"},{fileName:"194288.data",name:"Kessex Hills (1)"},{fileName:"672138.data",name:"Kessex Hills (2)"},{fileName:"861815.data",name:"Kessex Hills (3)"},{fileName:"286945.data",name:"Bloodtide Coast"},{fileName:"287870.data",name:"Harathi Hinterlands"},{fileName:"289176.data",name:"Gendarran Fields"},{fileName:"295005.data",name:"Chantry of Secrets"},{fileName:"294938.data",name:"Claw Island"}]},{name:"04. Maguuma Jungle",maps:[{fileName:"195149.data",name:"Caledon Forest"},{fileName:"195493.data",name:"Metrica Province"},{fileName:"922320.data",name:"Metrica Province Instance"},{fileName:"198076.data",name:"The Grove (0)"},{fileName:"1969341.data",name:"The Grove (1)"},{fileName:"198272.data",name:"Rata Sum (0)"},{fileName:"1968896.data",name:"Rata Sum (1)"},{fileName:"291064.data",name:"Mount Maelstrom"},{fileName:"292254.data",name:"Sparkfly Fen"},{fileName:"293307.data",name:"Brisban Wildlands"}]},{name:"05. Ruins of Orr",maps:[{fileName:"284829.data",name:"Straits of Devastation"},{fileName:"285089.data",name:"Malchor's Leap"},{fileName:"285634.data",name:"Cursed Shore"},{fileName:"295179.data",name:"Cathedral of Hidden Depths"},{fileName:"295962.data",name:"A Light in the Darkness"}]},{name:"06. Living World S1",maps:[{fileName:"520479.data",name:"Southsun Cove"},{fileName:"679089.data",name:"Tower of Nightmares"}]},{name:"07. Living World S2",maps:[{fileName:"836211.data",name:"Dry top (0)"},{fileName:"861770.data",name:"Dry top (1)"},{fileName:"909361.data",name:"The Silverwastes (0)"},{fileName:"996202.data",name:"The Silverwastes (1)"},{fileName:"908730.data",name:"Glint's Lair"}]},{name:"08. Heart of Maguuma",maps:[{fileName:"969663.data",name:"Verdant Brink"},{fileName:"1262460.data",name:"Hearts and Minds"},{fileName:"969964.data",name:"Unknown Airship in tree"},{fileName:"1262310.data",name:"Dragon Stand"},{fileName:"1263739.data",name:"Tarir"},{fileName:"1264291.data",name:"Tangled Depths"}]},{name:"09. Living World S3",maps:[{fileName:"1472635.data",name:"(E1) Bloodstone Fen"},{fileName:"1498071.data",name:"(E2) Taimi Simulator"},{fileName:"1498578.data",name:"(E2) Ring of Fire"},{fileName:"1605211.data",name:"(E3) Bitterfrost Frontier"},{fileName:"1645474.data",name:"(E4) Caudecus Manor"},{fileName:"1646520.data",name:"(E4) Lake Doric"},{fileName:"1682493.data",name:"(E5) Draconis Mons"},{fileName:"1682763.data",name:"(E5) Titan's Throat"},{fileName:"1734839.data",name:"(E6) White Mantle Fortress"},{fileName:"1735346.data",name:"(E6) Siren's Landing"},{fileName:"1735440.data",name:"(E6) Shining Blade Headquarters"}]},{name:"10. Crystal Desert",maps:[{fileName:"1794574.data",name:"Crystal Oasis"},{fileName:"1833034.data",name:"Desert Highlands"},{fileName:"1833726.data",name:"PoF story instances"},{fileName:"1839188.data",name:"Domain of Vabbi"},{fileName:"1840103.data",name:"Elon Riverlands"},{fileName:"1840368.data",name:"Kormir Sanctuary"},{fileName:"1842533.data",name:"The Desolation"}]},{name:"11. Living World S4",maps:[{fileName:"1901428.data",name:"(E1) Fahranur"},{fileName:"1902235.data",name:"(E1) Istan"},{fileName:"1903523.data",name:"(E1) Crystal Oasis"},{fileName:"1954984.data",name:"(E2) Desert Highlands"},{fileName:"1955224.data",name:"(E2) Inquest Lab Tower"},{fileName:"1955471.data",name:"(E2) Rata Primus"},{fileName:"1955642.data",name:"(E2) Divinity's Reach"},{fileName:"1955915.data",name:"(E2) Mount Maelstrom"},{fileName:"1956140.data",name:"(E2) Frostgorge Sound"},{fileName:"1956245.data",name:"(E2) Void"},{fileName:"1956299.data",name:"(E2) Hided Inquest Lab"},{fileName:"1957526.data",name:"(E2) Sandswept Isles"}]},{name:"12. Seasonal Activities",maps:[{fileName:"506592.data",name:"Ascent to Madness"},{fileName:"506670.data",name:"Mad King's Labyrinth (Past)"},{fileName:"662436.data",name:"Mad King's Labyrinth (Present)"},{fileName:"506739.data",name:"Mad King's Clock Tower"},{fileName:"622681.data",name:"The Crown Pavilion"},{fileName:"569756.data",name:"SAB Hub (0)"},{fileName:"636133.data",name:"SAB Hub (1)"},{fileName:"635555.data",name:"SAB World 1"},{fileName:"635960.data",name:"SAB World 2"},{fileName:"606255.data",name:"Zephyr Sanctum"},{fileName:"529896.data",name:"Tixx's Infinirarium"},{fileName:"529945.data",name:"Winter Wonderland"}]},{name:"13. Activites",maps:[{fileName:"605983.data",name:"Sanctum Sprint"},{fileName:"606030.data",name:"Basket Brawl"}]},{name:"14. Dungeons",maps:[{fileName:"126840.data",name:"Ascalonian Catacombs (0)"},{fileName:"189364.data",name:"Ascalonian Catacombs (1)"},{fileName:"275474.data",name:"Sorrow's Embrace"},{fileName:"276520.data",name:"Honor of the Waves"},{fileName:"284039.data",name:"Citadel of Flame"},{fileName:"287214.data",name:"Caudecus's Manor"},{fileName:"291284.data",name:"Twilight Arbor (0)"},{fileName:"645968.data",name:"Twilight Arbor (1)"},{fileName:"293606.data",name:"Crucible of Eternity"},{fileName:"473930.data",name:"The Ruined City of Arah"},{fileName:"473765.data",name:"Arah - Story"},{fileName:"580061.data",name:"Molten Facility"},{fileName:"595722.data",name:"Aetherblade Retreat"}]},{name:"15. Fractals",maps:[{fileName:"519839.data",name:"Fractals of the Mists"},{fileName:"697450.data",name:"Thaumanova Reactor"},{fileName:"1426653.data",name:"Cliffside Fractal"},{fileName:"1472361.data",name:"Chaos Isle Fractal"},{fileName:"1472382.data",name:"Snowblind Fractal"},{fileName:"1472406.data",name:"Swampland Fractal"},{fileName:"1498016.data",name:"Mistlock Observatory"},{fileName:"1498798.data",name:"Aetherblade/Mai Trin Fractal"},{fileName:"1605344.data",name:"Nightmare Fractal"},{fileName:"1733857.data",name:"Shattered Observatory Fractal"},{fileName:"1733961.data",name:"Mistlock Sanctuary"},{fileName:"1905739.data",name:"Molten Boss Fractal"},{fileName:"1905889.data",name:"Twilight Oasis Fractal"}]},{name:"16. Raid",maps:[{fileName:"1151420.data",name:"(W1) Spirit Vale"},{fileName:"1383309.data",name:"(W2) Salvation Pass"},{fileName:"1427048.data",name:"Special Forces Training Area"},{fileName:"1454070.data",name:"(W3) Stronghold of the Faithful"},{fileName:"1645215.data",name:"(W4) Bastion of the Penitent"},{fileName:"1906329.data",name:"(W5) Hall of Chains"}]},{name:"17. Structured PvP",maps:[{fileName:"871093.data",name:"Original Stronghold"},{fileName:"870987.data",name:"Battle of Champion's Dusk (0)"},{fileName:"1666233.data",name:"Battle of Champion's Dusk (1)"},{fileName:"132570.data",name:"Heart of the Mists (0)"},{fileName:"197249.data",name:"Heart of the Mists (1)"},{fileName:"1734729.data",name:"Heart of the Mists (2)"},{fileName:"1712986.data",name:"Hall of the Mists"},{fileName:"132710.data",name:"The Battle of Khylo (0)"},{fileName:"197402.data",name:"The Battle of Khylo (1)"},{fileName:"132837.data",name:"Forest of Niflhel (0)"},{fileName:"197545.data",name:"Forest of Niflhel (1)"},{fileName:"376916.data",name:"Legacy of the Foefire"},{fileName:"467374.data",name:"Raid on the Capricorn"},{fileName:"520609.data",name:"Temple of the Silent Storm"},{fileName:"579383.data",name:"Skyhammer (0)"},{fileName:"677968.data",name:"Skyhammer (1)"},{fileName:"1934470.data",name:"Skyhammer (2)"},{fileName:"791564.data",name:"Courtyard (0)"},{fileName:"1713054.data",name:"Courtyard (1)"},{fileName:"556199.data",name:"Spirit Watch (0)"},{fileName:"1473061.data",name:"Spirit Watch (1)"},{fileName:"506539.data",name:"Reaper's Rumble"},{fileName:"529718.data",name:"Snowball Mayhem"},{fileName:"595582.data",name:"Dragon Ball Arena"},{fileName:"617120.data",name:"Aspect Arena"},{fileName:"1644624.data",name:"Revenge of the Capricorn"},{fileName:"1704155.data",name:"Eternal Coliseum"}]},{name:"18. World vs World",maps:[{fileName:"131235.data",name:"Eternal Battlegrounds (0)"},{fileName:"195806.data",name:"Eternal Battlegrounds (1)"},{fileName:"1885693.data",name:"Eternal Battlegrounds (2)"},{fileName:"1918037.data",name:"Eternal Battlegrounds (3)"},{fileName:"131574.data",name:"Alpine Borderlands (0)"},{fileName:"641501.data",name:"Alpine Borderlands (1)"},{fileName:"1799855.data",name:"Alpine Borderlands (2)"},{fileName:"1647236.data",name:"Desert Borderlands (0)"},{fileName:"1799442.data",name:"Desert Borderlands (1)"},{fileName:"736241.data",name:"Edge of the Mists"}]},{name:"19. Guild Halls",maps:[{fileName:"1255378.data",name:"Gilded Hollow"},{fileName:"1256064.data",name:"Lost Precipice"},{fileName:"1843274.data",name:"Windswept Haven"}]},{name:"20. Concept and not released",maps:[{fileName:"122695.data",name:"Empty Plane"},{fileName:"184799.data",name:"Empty Plane v1"},{fileName:"197562.data",name:"Empty Plane v2"},{fileName:"875614.data",name:"Unknown Mists Platforms"},{fileName:"132853.data",name:"Empty Box"},{fileName:"1255516.data",name:"Guild Coliseum"},{fileName:"1498193.data",name:"Concept sPVP Map 1"},{fileName:"1513556.data",name:"Concept sPVP Map 2"},{fileName:"1513607.data",name:"Concept sPVP Map 3"},{fileName:"1513620.data",name:"Concept sPVP Map 4"},{fileName:"1513675.data",name:"Concept sPVP Map 5"},{fileName:"1712945.data",name:"Concept sPVP Map 6"}]}]}},{}],8:[function(e,t,a){(function(a){const n=e("./LocalReader/LocalReader"),r={t3dtoolsWorker:"modules/t3dtools/t3dworker.js",concurrentTasks:"undefined"!=typeof navigator?navigator.hardwareConcurrency:1};let i;i=t.exports={version:"1.2.0",GW2File:e("./format/file/GW2File"),GW2Chunk:e("./format/file/GW2Chunk"),DataRenderer:e("./dataRenderer/DataRenderer"),EnvironmentRenderer:e("./dataRenderer/EnvironmentRenderer"),HavokRenderer:e("./dataRenderer/HavokRenderer"),PropertiesRenderer:e("./dataRenderer/PropertiesRenderer"),SingleModelRenderer:e("./dataRenderer/SingleModelRenderer"),TerrainRenderer:e("./dataRenderer/TerrainRenderer"),ZoneRenderer:e("./dataRenderer/ZoneRenderer"),StringRenderer:e("./dataRenderer/StringRenderer"),Logger:e("./Logger"),MapFileList:e("./MapFileList"),RenderUtils:e("./util/RenderUtils.js"),getLocalReader:function(e,t,a){const i=new n({workerPath:a||r.t3dtoolsWorker,workersNb:r.concurrentTasks});return i.openArchive(e).then(()=>{t(i)}),i},getFileListAsync:function(e,t){e.readFileList().then(e=>{let a={};for(let t of e)void 0===a[t.fileType]&&(a[t.fileType]=[]),a[t.fileType].push(t.mftId);t(a)})},getMapListAsync:function(e,t,a){function n(e){let t=[];for(let a of e){let e=t.findIndex(e=>e.name===a.category);-1===e&&(e=t.push({name:a.category,maps:[]})-1),t[e].maps.push({fileName:a.baseId,name:a.name})}return t.sort((e,t)=>e.name<t.name?-1:e.name>t.name?1:0),{maps:t}}a?e.readFileList().then(()=>{t(n(e.getMapList()))}):t(n(e.getMapList()))},renderMapContentsAsync:function(e,t,a,n,r){let o={};if(parseInt(t))e.readFile(parseInt(t),!1,!1,void 0,void 0,!0).then(t=>{let r=t.buffer,s=new DataStream(r,0,DataStream.LITTLE_ENDIAN),l=new i.GW2File(s,0);const d=function(t){t<a.length?i.runRenderer(a[t].renderClass,e,Object.assign(a[t].settings,{mapFile:l}),o,d.bind(this,t+1)):n(o)};d(0)});else{(r||i.Logger).log(i.Logger.TYPE_ERROR,"Map id must be an integer!, was:",t)}},runRenderer:function(e,t,a,n,r){new e(t,a,n).renderAsync(r)},getContextValue:function(e,t,a,n){let r=e[t.name];return r&&r[a]?r[a]:n},hasWebGL:function(e){if(window.WebGLRenderingContext){let t=document.createElement("canvas"),a=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1;for(let r=0;r<4;r++)try{if((n=t.getContext(a[r]))&&"function"==typeof n.getParameter)return!e||{name:a[r],gl:n}}catch(e){}return!1}return!1}},function(){let e=0;a.window&&window.indexedDB||(i.Logger.log(i.Logger.TYPE_ERROR,"T3D persistant storing and loading requires indexedDB support."),e++),"undefined"==typeof DataStream&&(i.Logger.log(i.Logger.TYPE_ERROR,"T3D core functionality requires DataStream library."),e++),"undefined"==typeof THREE&&(i.Logger.log(i.Logger.TYPE_WARNING,"T3D mesh generation requires three.js library."),e++),e<1&&i.Logger.log(i.Logger.TYPE_MESSAGE,"Tyria 3D API v"+i.version+" initialized.")}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./LocalReader/LocalReader":4,"./Logger":6,"./MapFileList":7,"./dataRenderer/DataRenderer":9,"./dataRenderer/EnvironmentRenderer":10,"./dataRenderer/HavokRenderer":11,"./dataRenderer/PropertiesRenderer":12,"./dataRenderer/SingleModelRenderer":13,"./dataRenderer/StringRenderer":14,"./dataRenderer/TerrainRenderer":15,"./dataRenderer/ZoneRenderer":16,"./format/file/GW2Chunk":17,"./format/file/GW2File":18,"./util/RenderUtils.js":28}],9:[function(e,t,a){const n=e("../format/file/GW2File"),r=e("../LocalReader/FileTypes");t.exports=class DataRenderer{constructor(e,t,a,n){this.localReader=e,this.settings=t,t||(t={}),this.context=a,this.context[this.constructor.name]={},this.logger=n||T3D.Logger}getOutput(e){return this.context[e?e.name:this.constructor.name]}renderAsync(e){this.localReader.readFile(this.settings.id,!1,!1,void 0,void 0,!0).then(t=>{let a=t.buffer;this.getOutput().fileId=this.settings.id,this.getOutput().rawData=a;let i=new Uint8Array(a),o=new TextDecoder("latin2");this.getOutput().rawString=o.decode(i);let s=new DataStream(a),l=s.readCString(4);r.getAnetTextureType(l)?this.localReader.readFile(this.settings.id,!0,!1,void 0,void 0,!0).then(t=>{let a={data:new Uint8Array(t.buffer),width:t.imageWidth,height:t.imageHeight};this.getOutput().image=a,e()}):0===l.indexOf("PF")?(this.getOutput().file=new n(s,0),e()):(this.getOutput().file=null,e())})}}},{"../LocalReader/FileTypes":3,"../format/file/GW2File":18}],10:[function(e,t,a){const n=e("../util/MapEnvUtils"),r=e("./DataRenderer");t.exports=class EnvironmentRenderer extends r{constructor(e,t,a,n){super(e,t,a,n),this.mapFile=this.settings.mapFile}renderAsync(e){let t=this.mapFile.getChunk("env").data,a=this.mapFile.getChunk("parm").data,r=n.getHazeColor(t),i=256*r[2]*256+256*r[1]+r[0];this.getOutput().hazeColor=r;let o=n.parseLights(t);this.getOutput().hasLight=o.hasLight,this.getOutput().lights=o.lights,this.getOutput().skyElements=n.parseSkybox(t,a,i,["img/193068.png","img/193070.png","img/193072.png"],this.localReader).skyElements,e()}}},{"../util/MapEnvUtils":20,"./DataRenderer":9}],11:[function(e,t,a){const n=e("./DataRenderer"),r=e("../util/MapHavokUtils");t.exports=class HavokRenderer extends n{constructor(e,t,a,n){super(e,t,a,n),this.mapFile=this.settings.mapFile,this.lastP=-1,this.seed=1,this.meshes=[]}renderAsync(e){this.havokChunkData=this.mapFile.getChunk("havk").data,this.getOutput().boundingBox=this.havokChunkData.boundsMax,this.meshes=[];let t=this.havokChunkData.propModels,a=this.havokChunkData.zoneModels,n=this.havokChunkData.obsModels;for(const e of n)e.scale=1;this.geometries=this.havokChunkData.geometries,this.animations=this.havokChunkData.animations;const r=()=>{this.renderModels(n,"obs",e)};this.renderModels(t,"prop",()=>{this.renderModels(a,"zone",r)})}renderModels(e,t,a){r.renderModels({settings:this.settings,lastP:this.lastP,geometries:this.geometries,animations:this.animations,havokChunkData:this.havokChunkData,meshes:this.meshes,output:{meshes:[]}},e,t,e=>{let t=this.getOutput().meshes;this.getOutput().meshes=t?t.concat(e.meshes):e.meshes,a()})}}},{"../util/MapHavokUtils":21,"./DataRenderer":9}],12:[function(e,t,a){const n=e("./DataRenderer"),r=e("../util/MapPropsUtils");t.exports=class PropertiesRenderer extends n{constructor(e,t,a,n){super(e,t,a,n),this.mapFile=this.settings.mapFile}renderAsync(e){let t=this.mapFile.getChunk("prp2").data;if(!t)return void e();let a=t.propArray,n=t.propAnimArray,i=t.propInstanceArray,o=t.propMetaArray;a=a.concat(n).concat(i).concat(o),r.renderIndex(this.localReader,a,0,t=>{this.getOutput().meshes=t.meshes,e()})}getFileIdsAsync(e){const t=this.mapFile.getChunk("prp2").data;let a=t.propArray;const n=t.propAnimArray,i=t.propInstanceArray,o=t.propMetaArray;a=a.concat(n).concat(i).concat(o),r.getIdsForProp(a,0,e)}}},{"../util/MapPropsUtils":22,"./DataRenderer":9}],13:[function(e,t,a){const n=e("../util/ModelUtils"),r=e("./DataRenderer");t.exports=class SingleModelRenderer extends r{constructor(e,t,a,n){super(e,t,a,n)}renderAsync(e){let t=this,a=this.settings.id,r={};t.getOutput().meshes=[],n.getMeshesForFilename(a,65280,t.localReader,r,{},!0,!0,function(a,n,i){a&&a.forEach(function(e){e.boundingSphere=i,t.getOutput().meshes.push(e)}),r={},e()})}}},{"../util/ModelUtils":27,"./DataRenderer":9}],14:[function(e,t,a){const n=e("./DataRenderer");t.exports=class StringRenderer extends n{constructor(e,t,a,n){super(e,t,a,n)}renderAsync(e){let t=this;this.settings.id,this.getOutput().strings=[],this.localReader.readFile(this.settings.id,!1,!1,void 0,void 0,!0).then(a=>{let n=a.buffer,r=new DataStream(n),i=r.byteLength-2;r.seek(4);let o=["size","uint16","decryptionOffset","uint16","bitsPerSymbol","uint16"],s=0;for(;i-r.position>6;){let e=r.readStruct(o);if(e.size-=6,e.size>0&&0===e.decryptionOffset&&16===e.bitsPerSymbol){let a=r.readUCS2String(e.size/2);t.getOutput().strings.push({value:a,recid:s})}s++}r.seek(r.byteLength-2),t.getOutput().language=r.readUint16(),e()})}}},{"./DataRenderer":9}],15:[function(e,t,a){const n=e("./DataRenderer"),r=e("../util/MapTerrainUtils");t.exports=class TerrainRenderer extends n{constructor(e,t,a,n){super(e,t,a,n),this.mapFile=this.settings.mapFile}renderAsync(e){const t=this.mapFile.getChunk("trn").data.materials.pagedImage;this.localReader.readFile(t,!1,!1,void 0,void 0,!0).then(e=>r.loadPagedImageCallback(e.buffer,this.mapFile,this.settings.anisotropy,this.getOutput(T3D.EnvironmentRenderer),this.localReader)).then(t=>{this.getOutput().terrainTiles=t.terrainTiles,this.getOutput().water=t.water,this.getOutput().bounds=t.mapRect,e()})}getFileIdsAsync(e){e(r.getTerrainFilesId(this.mapFile))}}},{"../util/MapTerrainUtils":23,"./DataRenderer":9}],16:[function(e,t,a){const n=e("./DataRenderer"),r=e("../util/MapZoneUtils");t.exports=class ZoneRenderer extends n{constructor(e,t,a,n){super(e,t,a,n),this.mapFile=this.settings.mapFile}renderAsync(e){this.getOutput().meshes=[];let t=this.mapFile.getChunk("zon2").data,a=this.mapFile.getChunk("parm").data.rect,n=t.zoneArray,i=t.zoneDefArray,o=-1;const s={localReader:this.localReader,terrainTiles:this.getOutput(T3D.TerrainRenderer).terrainTiles,output:{meshes:[]}},l=t=>{let d=Math.round(100*t/n.length);o!==d&&(T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Zone)",d),o=d),t>=n.length?e():r.renderZone(s,n[t],i,a,()=>{this.getOutput().meshes=this.getOutput().meshes.concat(s.output.meshes),l(t+1)})};l(0)}}},{"../util/MapZoneUtils":24,"./DataRenderer":9}],17:[function(e,t,a){const n=["type","cstring:4","chunkDataSize","uint32","chunkVersion","uint16","chunkHeaderSize","uint16","offsetTableOffset","uint32"];let r;const i=[{pack:"MODL",chunk:"ANIM",root:"ModelFileAnimation"},{pack:"MODL",chunk:"GAME",root:"ModelFileGame"},{pack:"MODL",chunk:"SKEL",root:"ModelFileSkeleton"},{pack:"MODL",chunk:"TOOL",root:"ModelFileTool"},{pack:"cntc",chunk:"Main",root:"PackContent"},{pack:"mMet",chunk:"Main",root:"PackMapMetadata"},{pack:"AMAT",chunk:"TOOL",root:"AmatToolParams"},{pack:"cmaC",chunk:"main",root:"CollideModelManifest"}];class GW2Chunk{constructor(e,t){!function(){if(!r){r={};for(let t of i){let a=new RegExp(`^${t.root}(V[0-9]*)?$`),n=T3D.formats.filter(e=>e.name===t.chunk);for(let i in n){let o=n[i].versions;if(e(o[Object.keys(o).pop()]).match(a)){r[t.chunk]||(r[t.chunk]=[]),r[t.chunk][i]=t.pack;break}}}}function e(e){let t=new e;return Object.keys(t).filter(e=>t[e]===t.__root&&"__root"!==e)[0]}}(),this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.loadHead()}loadHead(){this.ds.seek(this.addr),this.header=this.ds.readStruct(n),this.headerLength=this.ds.position-this.addr}getDefinition(e){let t=0,a=r[this.header.type];if(a){t=-1;for(let n=0;n<a.length&&-1===t;n++){a[n]===e&&(t=n)}}let n=0;for(let e=0;e<T3D.formats.length;e++){let a=T3D.formats[e];if(a.name===this.header.type){if(n===t&&a.versions[this.header.chunkVersion])return(new a.versions[this.header.chunkVersion]).__root;n++}}}loadData(e){let t=this.getDefinition(e);t?(this.ds.seek(this.addr+this.headerLength),this.data=this.ds.readStruct(t)):T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Could not find a definition for chunk",this.header.type,"version",this.header.chunkVersion,"file name",e)}next(){try{return new GW2Chunk(this.ds,this.addr+8+this.header.chunkDataSize)}catch(e){}return null}}t.exports=GW2Chunk},{}],18:[function(e,t,a){const n=e("./GW2Chunk"),r=["identifier","cstring:2","unknownField1","uint16","unknownField2","uint16","pkFileVersion","uint16","type","cstring:4"];t.exports=class GW2File{constructor(e,t,a){this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.chunks=[],this.readHead(),a||this.readChunks()}readHead(){this.ds.seek(this.addr),this.header=this.ds.readStruct(r),this.headerLength=this.ds.position-this.addr}readChunks(){this.chunks=[];let e=new n(this.ds,this.headerLength+this.addr);for(;null!=e&&e.header.type;)e.loadData(this.header.type),this.chunks.push(e),e=e.next()}getChunk(e){for(let t=0;t<this.chunks.length;t++)if(this.chunks[t].header.type.toLowerCase()===e.toLowerCase())return this.chunks[t];return null}getChunkStructs(){return{}}}},{"./GW2Chunk":17}],19:[function(e,t,a){t.exports={fvfFormat:{Position:1,Weights:2,Group:4,Normal:8,Color:16,Tangent:32,Bitangent:64,TangentFrame:128,UV32Mask:65280,UV16Mask:16711680,Unknown1:16777216,Unknown2:33554432,Unknown3:67108864,Unknown4:134217728,PositionCompressed:268435456,Unknown5:536870912}}},{}],20:[function(e,t,a){const n=e("./MaterialUtils");function r(e){return new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide,fog:!1,depthWrite:!1})}function i(e,t,a,i,o,s){function l(a){for(let n of e)t[n]=a}function d(){l(r((new THREE.TextureLoader).load(i)))}l(r(n.loadLocalTexture(s,a,null,o,function(){setTimeout(d,1)})))}t.exports={getHazeColor:function(e){let t=e&&e.dataGlobal.haze;return!t||t.length<=0?[190,160,60]:t[0].farColor},parseLights:function(e){let t,a=[],n=e?e.dataGlobal.lighting:[{lights:[],backlightIntensity:1,backlightColor:[255,255,255]}],r=!1;for(let e in n){let i=n[e];if(r)break;let o=0;for(let e of i.lights){r=!0;let t=new THREE.Color(e.color[2]/255,e.color[1]/255,e.color[0]/255),n=new THREE.DirectionalLight(t.getHex(),e.intensity);n.position.set(-e.direction[0],e.direction[2],e.direction[1]).normalize(),o+=e.intensity,a.push(n)}if(!i.lights||0===i.lights.length){const e=[[0,1,0,.3],[1,2,1,.3],[-1,-2,-1,.3]];for(let t of e){const e=new THREE.Color(1,1,1);let n=t[3],r=new THREE.DirectionalLight(e.getHex(),n);r.position.set(t[0],t[1],t[2]).normalize(),o+=n,a.push(r)}}i.backlightIntensity=o;const s=new THREE.Color(i.backlightIntensity*(255-i.backlightColor[2])/255,i.backlightIntensity*(255-i.backlightColor[1])/255,i.backlightIntensity*(255-i.backlightColor[0])/255);t=new THREE.AmbientLight(s)}let i=0;return t&&(i=t.color.r+t.color.g+t.color.b,a.push(t)),{lights:a,hasLight:r||i>0}},parseSkybox:function(e,t,a,n,r){let o=[],s=this.environmentChunkData&&this.environmentChunkData.dataGlobal.skyModeTex[0];s||(s={texPathNE:1930687,texPathSW:193069,texPathT:193071});const l=t.rect;let d=Math.abs(l.x1-l.x2),m=Math.abs(l.y1-l.y2),f=(Math.max(d,m),[]);i([1,4],f,s.texPathNE+1,n[0],a,r),i([0,5],f,s.texPathSW+1,n[1],a,r),i([2],f,s.texPathT+1,n[2],a,r),f[3]=new THREE.MeshBasicMaterial({visible:!1});let h=new THREE.BoxGeometry(1024,512,1024);for(let e in h.faceVertexUvs[0]){let t=h.faceVertexUvs[0][e],a=Math.floor(e/2);if(0===a||1===a)for(let e of t)e.x=1-e.x,e.y/=2,e.y+=.5;else if(5===a||4===a)for(let e of t)e.y/=-2,e.y+=.5;else for(let e of t)e.x=1-e.x}h.uvsNeedUpdate=!0;let u=new THREE.Mesh(h,f);return u.translateY(256),o.push(u),{skyElements:o}}}},{"./MaterialUtils":25}],21:[function(e,t,a){function n(e,t){let a=[];for(let n=0;n<e.collisionIndices.length;n++){let r=e.collisionIndices[n],i=t[r];i.index=r,a.push(i)}return a}function r(e,t,a){let n=t[e].animations.length;return a[t[e].animations[n-1]]}function i(e,t,a,n){let r=a.translate,i=a.rotate,o=32*a.scale,s=function(e,t,a){let n=t.index;if(e.meshes[n])return e.meshes[n].clone();{let r=new THREE.Geometry;for(let e=0;e<t.vertices.length;e++){let a=t.vertices[e];r.vertices.push(new THREE.Vector3(a[0],a[2],-a[1]))}for(let e=0;e<t.indices.length;e+=3){let a=t.indices[e],n=t.indices[e+1],i=t.indices[e+2];a<=t.vertices.length&&n<=t.vertices.length&&i<=t.vertices.length?r.faces.push(new THREE.Face3(a,n,i)):T3D.Logger.log(T3D.Logger.TYPE_ERROR,"Errorus index in havok model geometry.")}return r.computeFaceNormals(),e.meshes[n]=new THREE.Mesh(r,a),e.meshes[n]}}(e,t,n);s.position.set(r[0],-r[2],-r[1]),o&&s.scale.set(o,o,o),i&&(s.rotation.order="ZXY",s.rotation.set(i[0],-i[2],-i[1])),e.output.meshes.push(s)}t.exports={renderModels:function(e,t,a,o){let s;!function e(t,a,o,s,l,d,m){let f=d;for(;f<d+l&&f<a.length;f++){let e=Math.round(100*f/a.length);e!==t.lastP&&(T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Collision Models ("+s+")",e),t.lastP=e);let l=r(a[f].geometryIndex,t.geometries,t.animations),d=n(l,t.havokChunkData.collisions);for(let e=0;e<d.length;e++){let n=d[e];i(t,n,a[f],o)}}f<a.length?window.setTimeout(()=>{e(t,a,o,s,l,d+l,m)},10):m(t.output)}(e,t,s=e.settings&&e.settings.visible?new THREE.MeshNormalMaterial({side:THREE.DoubleSide}):new THREE.MeshBasicMaterial({visible:!1}),a,200,0,o)}}},{}],22:[function(e,t,a){const n=e("../util/ModelUtils"),r=function(e,t,a,i,o=-1,s={},l={},d={meshes:[]}){if(a>=t.length)return s={},l={},void i(d);let m=Math.round(1e3*a/t.length);if(o!==(m/=10)){let e=m+(m.toString().indexOf(".")<0?".0":"");T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Props)",e),o=m}let f=t[a],h=function(e,t,a,n,r){let i=0!==n.lod2?n.lod2:e.lodOverride[1];if(0===e.flags&&(i=0),r&&(e=new THREE.Mesh(e.geometry,e.material)),e.updateMatrix(),e.matrixAutoUpdate=!1,t[i])t[i].add(e);else{let n=new THREE.Group;n.updateMatrix(),n.matrixAutoUpdate=!1,n.add(e),t[i]=n,a.addLevel(n,i)}return i};n.getMeshesForFilename(f.filename,f.color,e,s,l,!1,!1,function(n,m,u){n&&function(e,t,a){let n={},r=new THREE.LOD,i=0;e.forEach(function(e){i=Math.max(i,h(e,n,r,f,t))}),r.addLevel(new THREE.Group,1e5),f.rotation&&(r.rotation.order="ZXY",r.rotation.set(f.rotation[0],-f.rotation[2],-f.rotation[1])),r.scale.set(f.scale,f.scale,f.scale),r.position.set(f.position[0],-f.position[2],-f.position[1]),r.boundingSphereRadius=(a&&a.radius?a.radius:1)*f.scale,r.updateMatrix(),r.matrixAutoUpdate=!1,d.meshes.push(r),f.transforms&&f.transforms.forEach(function(t){let n={},r=new THREE.LOD,i=0;e.forEach(function(e){i=Math.max(i,h(e,n,r,f,!0))}),t.rotation&&(r.rotation.order="ZXY",r.rotation.set(t.rotation[0],-t.rotation[2],-t.rotation[1])),r.scale.set(t.scale,t.scale,t.scale),r.position.set(t.position[0],-t.position[2],-t.position[1]),r.updateMatrix(),r.matrixAutoUpdate=!1,r.boundingSphereRadius=(a&&a.radius?a.radius:1)*f.scale,r.update(r),d.meshes.push(r)})}(n,m,u),r(e,t,a+1,i,o,s,l,d)})},i=function(e,t,a,r=[]){if(t>=e.length)return void a(r);t%100==0&&T3D.Logger.log(T3D.Logger.TYPE_MESSAGE,"getting ids for entry",t,"of",e.length);let o=e[t];n.getFilesUsedByModel(o.filename,this.localReader,function(n){r=r.concat(n),i(e,t+1,a,r)})};t.exports={renderIndex:r,getIdsForProp:i}},{"../util/ModelUtils":27}],23:[function(e,t,a){const n=e("./RenderUtils"),r=e("./MaterialUtils"),i=e("./TerrainShader"),o=e("../format/file/GW2File");t.exports={loadPagedImageCallback:async function(e,t,a,s,l){let d=[],m=new DataStream(e),f=new o(m,0).getChunk("pgtb"),h=f&&f.data,u=null,c=t.getChunk("trn").data,g=t.getChunk("parm").data,p=a||1;!function(e){e.numChunksD_1=Math.sqrt(e.dims[0]*e.chunkArray.length/e.dims[1]),e.numChunksD_2=e.chunkArray.length/e.numChunksD_1}(c);let T=c.numChunksD_1,E=c.numChunksD_2,R=c.materials.materials,y=c.materials.texFileArray,N=g.rect[2]-g.rect[0],x=g.rect[3]-g.rect[1],v=N/c.numChunksD_1*1,M=x/c.numChunksD_2*1,w=0,k=[],b=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:6710886,flatShading:!0}),D={};h&&h.strippedPages.forEach(function(e){if(e.layer<=1){let t=e.filename,a=e.coord,n=a[0]+","+a[1];if(1===e.layer&&(n+="-2"),!D[n]){let e=r.loadLocalTexture(l,t);e&&(e.anisotropy=p,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping),D[n]=e}}});let F=function(e,t){let a=t*T+e,n=Math.floor(e/4),o=Math.floor(t/4),m=R[a].loResMaterial.texIndexArray,f=b,h=e%4/4,E=.75-t%4/4,N=[];for(let e=0;e<m.length/2;e++){let t=y[m[e]].filename;if(N.push(t),!D[t]){let e=r.loadLocalTexture(l,t);e&&(e.anisotropy=p,e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping),D[t]=e}}let x=n+","+o,F=n+","+o+"-2",L={color:{r:1,g:1,b:1},near:0,far:0};s.hazeColor&&(L.color.r=s.hazeColor[2]/255,L.color.g=s.hazeColor[1]/255,L.color.b=s.hazeColor[0]/255);let S=THREE.UniformsUtils.merge([THREE.UniformsLib.lights]);S.uvScale={type:"v2",value:new THREE.Vector2(8,8)},S.offset={type:"v2",value:new THREE.Vector2(h,E)},S.texturePicker={type:"t",value:D[x]},S.texturePicker2={type:"t",value:D[F]},S.texture1={type:"t",value:D[N[0]]},S.texture2={type:"t",value:D[N[1]]},S.texture3={type:"t",value:D[N[2]]},S.texture4={type:"t",value:D[N[3]]},f=new THREE.ShaderMaterial({uniforms:S,fragmentShader:i.getFragmentShader(),vertexShader:i.getVertexShader()}),k.push(f);let _=new THREE.PlaneBufferGeometry(v,M,32,32),C=0;for(let e=0;e<35;e++)for(let t=0;t<35;t++)0!==t&&34!==t&&0!==e&&34!==e&&(_.getAttribute("position").array[3*C+2]=c.heightMapArray[w],C++),w++;let A,P=(new THREE.Matrix4).identity();P.elements[5]=-1,_.applyMatrix(P),_.computeFaceNormals(),A=new THREE.Mesh(_,b),(A=f.length?THREE.SceneUtils.createMultiMaterialObject(_,f):new THREE.Mesh(_,f)).rotation.set(Math.PI/2,0,0);let H=g.rect[0]+v/2,I=e*v;if(A.position.x=H+I,c.numChunksD_2%2==0){const e=g.rect[1]+M/2-0,a=t*M*1;A.position.z=a+e}else{const e=g.rect[1]-M/2+0,a=t*M*1;A.position.z=e+a}let U=A.position.x,O=A.position.z;u||(u={x1:U-v/2,x2:U+v/2,y1:O-M/2,y2:O+M/2}),u.x1=Math.min(u.x1,U-v/2),u.x2=Math.max(u.x2,U+v/2),u.y1=Math.min(u.y1,O-M/2),u.y2=Math.max(u.y2,O+M/2),A.updateMatrix(),A.updateMatrixWorld(),d.push(A)},L=0,S=0;for(;S<E;){F(L,S),(L+=1)>=T&&(L=0,S++),await new Promise(e=>setTimeout(e,1));let e=Math.floor(100*(S*T+L)/(T*E));T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Terrain",e)}return{terrainTiles:d,water:function(e){const t=new THREE.MeshBasicMaterial({color:6009320,wireframe:!1,opacity:.35});return t.transparent=!0,n.renderRect(e,0,t)}(u),mapRect:u}},getTerrainFilesId:function(e){let t=e.getChunk("trn"),a=e.getChunk("pimg"),n=[];return(a&&a.data).strippedPages.forEach(function(e){e.layer<=1&&e.filename>0&&n.push(e.filename)}),t.data.materials.texFileArray.forEach(function(e){e.filename>0&&n.push(e.filename)}),n}}},{"../format/file/GW2File":18,"./MaterialUtils":25,"./RenderUtils":28,"./TerrainShader":29}],24:[function(e,t,a){const n=e("../util/ModelUtils");t.exports={renderZone:function(e,t,a,r,i){let o=null;a.forEach(function(e){o||e.token!==t.defToken||(o=e)});let s=function(e,t,a,n){let r=n[0],i=n[1],o=48,s={x1:t.vertRect[0]*o+r,x2:t.vertRect[2]*o+r,y1:t.vertRect[1]*-o-i,y2:t.vertRect[3]*-o-i};if(0===t.encodeData.length)return{};let l=t.vertRect[0]-t.vertRect[2],d=0,m={},f=e.terrainTiles;for(let e=0;e<t.flags.length;e+=2){d+=t.flags[e];let n=t.flags[e+1];if(0!==n){let e=n>>4,t=a.layerDefArray[e-1];if(t){let e=d%l*o+s.x1,a=Math.floor(d/l)*o+s.y1,n=null;const r=1e5,i=new THREE.Raycaster(new THREE.Vector3(e,r,a),new THREE.Vector3(0,-1,0));f.forEach(function(e){if(null===n){let t=i.intersectObject(e);t.length>0&&(n=r-t[0].distance)}});let h=0,u=t.modelArray[h],c=u.filename,g=t.rotRangeX,p=t.rotRangeY,T=t.rotRangeZ,E=t.scaleRange,R=t.fadeRange;m[c]||(m[c]=[]),m[c].push({x:e,y:a,z:n,rotRangeX:g,rotRangeY:p,rotRangeZ:T,scaleRange:E,fadeRange:R})}}}return m}(e,t,o,r);e.meshCache={},e.textureCache={};let l=Object.keys(s);!function t(a){if(a>=l.length)return e.meshCache={},e.textureCache={},void i();let r=l[a],o=s[r],d=[];n.getMeshesForFilename(r,null,e.localReader,e.meshCache,e.textureCache,!1,!1,function(n,r){n&&o.forEach(function(e,t){n.forEach(function(a,n){if(525===a.materialFlags)return;let r={x:0,y:0,z:0};if(d[n])r.x=e.x-d[n].position.x,r.y=e.z-d[n].position.z,r.z=e.y-d[n].position.y;else{let t=a.geometry.clone();d[n]={readVerts:t.getAttribute("position").array,verts:new Float32Array(o.length*t.getAttribute("position").array.length),readIndices:t.getIndex().array,indices:new Uint32Array(o.length*t.getIndex().array.length),readUVs:t.getAttribute("uv").array,uvs:new Float32Array(o.length*t.getAttribute("uv").array.length),readNormals:t.getAttribute("normal").array,normals:new Float32Array(o.length*t.getAttribute("normal").array.length),material:a.material,position:{x:e.x,y:e.y,z:e.z}}}let i=d[n].readVerts,s=d[n].verts,l=i.length;for(let e=0,a=t*l;e<l;e+=3,a+=3)s[a+0]=i[e+0]+r.x,s[a+1]=i[e+1]+r.y,s[a+2]=i[e+2]+r.z;let m=d[n].readIndices,f=d[n].indices,h=m.length,u=l*t/3;for(let e=0,a=t*h;e<h;e++,a++)f[a]=m[e]+u;let c=d[n].readUVs,g=d[n].uvs,p=c.length;for(let e=0,a=t*p;e<p;e++,a++)g[a]=c[e];let T=d[n].readNormals,E=d[n].normals,R=T.length;for(let e=0,a=t*R;e<R;e++,a++)E[a]=T[e]})}),d.forEach(function(t){let a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(t.verts,3)),a.setIndex(new THREE.BufferAttribute(t.indices,1)),a.addAttribute("normal",new THREE.BufferAttribute(t.normals,3)),a.addAttribute("uv",new THREE.BufferAttribute(t.uvs,2)),a.buffersNeedUpdate=!0;let n=new THREE.Mesh(a,t.material);n.position.set(t.position.x,t.position.z,t.position.y),e.output.meshes.push(n)}),t(a+1)})}(0)}}},{"../util/ModelUtils":27}],25:[function(e,t,a){function n(e){let t="",a="",n="";for(let r=0;r<e;r++)t+="varying vec2 vUv_"+(r+1)+";\n",r>1&&(a+="attribute vec2 uv"+(r+1)+";\n"),n+="vUv_"+(r+1)+" = uv"+(r>0?r+1:"")+";\n";return a+t+"void main()\n{\n"+n+"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"}function r(e,t,a){let n=e*t,r=new Uint8Array(4*n),i=Math.floor(255*a.r),o=Math.floor(255*a.g),s=Math.floor(255*a.b);for(let e=0;e<n;e++){let t=4*e;r[t]=i,r[t+1]=o,r[t+2]=s,r[t+3]=255}return new THREE.DataTexture(r,e,t,THREE.RGBAFormat)}function i(e,t,a,n){let r="vUv_"+(e[0].uvIdx+1),i="";a&&(i="    if (c1.a < 0.5) \n       discard;\n");let o="gl_FragColor = c1;\n";if(n){o="   vec4 c2 = texture2D( texture"+(0+1)+", "+"vUv_1"+" );\n     gl_FragColor = c2;\n"}let s="";e.forEach(function(e,t){s+="uniform sampler2D texture"+(t+1)+";\n"});let l="";for(let e=0;e<t;e++)l+="varying vec2 vUv_"+(e+1)+";\n";return s+l+"void main( void ) {\n    vec4 c1 = texture2D( texture1, "+r+" );\n"+i+o+"}"}function o(e,t,a){let r=!1,o={};e.forEach(function(e,t){o["texture"+t]={type:"t",value:e}}),e.length>1&&(r=!0);let s={};for(let e=2;e<t;e++)s["uv"+(e+1)]={type:"v2",value:[]};let l=n(t);return new THREE.ShaderMaterial({uniforms:o,vertexShader:l,fragmentShader:i(e,t,a,r),attributes:s,side:THREE.FrontSide})}function s(e,t,a){let n;return e&&a[e]?n=a[e]:e&&((n=l(t,e)).wrapT=THREE.RepeatWrapping,n.wrapS=THREE.RepeatWrapping,n.flipY=!1,a[e]=n),n}function l(e,t,a,n,i){void 0===n&&(n=Math.floor(16777215*Math.random()));let o=r(1,1,new THREE.Color(n));return o.minFilter=THREE.LinearMipMapLinearFilter,o.magFilter=THREE.LinearFilter,o.generateMipmaps=!0,o.flipY=!0,parseInt(t)<=0?(i&&i(),o):(e.readFile(t,!0,!1,void 0,void 0,!0).then(e=>{if(!e.buffer)return void(i&&i());let t={data:new Uint8Array(e.buffer),width:e.imageWidth,height:e.imageHeight};o.format=(3==e.dxtType||e.dxtType,THREE.RGBAFormat),o.image=t,o.needsUpdate=!0}),o)}t.exports={buildVS:n,generateDataTexture:r,buildPS:i,getUVMat:o,getMaterial:function(e,t,a,n){if(!t)return;const r=t.getChunk("dx9s"),i=t.getChunk("grmt");let o,l=[];if(e&&e.textures.length){let t=r.data.techniques[0].passes[0].effects[0],o=[];for(let a=0;a<t.samplerIndex.length;a++){let n=t.samplerIndex[a],s=r.data.samplers[n];if(!s)continue;let l=s&&i.data.texTokens[s.textureIndex];l||(l="0-0");let d=null;if(e.textures.forEach(function(e,t){d||e.token.split("-")[0]!==l.split("-")[0]||(d=e)}),d)o.push(d);else if(s)o.push(e.textures[s.textureIndex]);else{if(!(e.textures.length>0))return;o.push(e.textures[0])}}if(o.length<=0)return;o.forEach(function(e,t){if(!e)return;let r=e&&e.filename;l[t]=s(r,a,n),l[t]&&(l[t].uvIdx=e.uvPSInputIndex)})}if(l){let t=!1,r=!1;if(e.textures.forEach(function(e){t||"1733499172"!=e.token.split("-")[0]||(t=e),r||"404146670"!=e.token.split("-")[0]||(r=e)}),!t||t.filename<=0)return;if(o=new THREE.MeshPhongMaterial({side:THREE.FrontSide,map:s(t.filename,a,n)}),r){let e=s(r.filename,a,n);e.flipY=!0,o.normalMap=e}o.textureFilename=t.filename,16460!=i.data.flags&&(o.alphaTest=.05)}else o=new THREE.MeshBasicMaterial({side:THREE.FrontSide,color:16711680,shading:THREE.FlatShading});if(o.needsUpdate=!0,e){let a=1,n=16;const r=t.getChunk("grmt");e.materialFlags&a||e.materialFlags&n||e.materialFlags;let i=8;[16460,16452,16448,8268,3392,2380,2368,332,324,320,76,68,64].indexOf(r.data.flags)<0&&T3D.Logger.log(T3D.Logger.TYPE_WARNING,"unknown GR flag",r.data.flags),r.data.flags&i||(o=new THREE.MeshBasicMaterial({side:THREE.FrontSide,map:o.map})),16460!=r.data.flags&&(o.alphaTest=.05)}return o},loadLocalTexture:l}},{}],26:[function(e,t,a){const n=Math.pow(2,32);t.exports={f16:function(e){let t=(32768&e)>>15,a=(31744&e)>>10,n=1023&e;return 0===a?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):31===a?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,a-15)*(1+n/Math.pow(2,10))},popcount:function(e){return e=(252645135&(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459)))+(e>>4&252645135),(e+=e>>8)+(e>>15)&63},arr32To64:function(e){return n*e[1]+e[0]},sort_unique:function(e,t){let a=Array.prototype.sort.call(e,t),n={};const r=[];for(let e=0,t=a.length;e<t;++e)n.hasOwnProperty(a[e])||(r.push(a[e]),n[a[e]]=1);return r}}},{}],27:[function(e,t,a){const n=e("../format/file/GW2File"),r=e("./MaterialUtils"),i=e("./MathUtils");let o={};const s=e("./Constants").fvfFormat;function l(e,t,a,n,l){let d=t.data.meshes,m=[],f=a.data.permutations[0].materials;for(let t of d){let d=t.geometry,h=d.verts.mesh.fvf,u=d.verts.vertexCount,c=d.verts.mesh.vertices,g=d.indices.indices,p=new THREE.BufferGeometry,T=new DataStream(c.buffer),E=c.length/u,R=new Float32Array(3*u),y=[],N=12*!!(h&s.Position)+4*!!(h&s.Weights)+4*!!(h&s.Group)+12*!!(h&s.Normal)+4*!!(h&s.Color)+12*!!(h&s.Tangent)+12*!!(h&s.Bitangent)+12*!!(h&s.TangentFrame),x=(h&s.UV32Mask)>>8,v=(h&s.UV16Mask)>>16,M=!!x,w=!!v||!!x,k=M?x:v,b=i.popcount(k);if(b=Math.min(b,1),w)for(let e=0;e<b;e++)y[e]=new Float32Array(2*u);for(let e=0;e<u;e++){T.seek(e*E);let t=T.readFloat32(),a=T.readFloat32(),n=T.readFloat32();if(R[3*e+0]=t,R[3*e+1]=-n,R[3*e+2]=-a,w)for(let t=0;t<b;t++){let a,n;T.seek(e*E+N+t*(M?8:4)),M?(a=T.readUint32(),n=T.readUint32()):(a=i.f16(T.readUint16()),n=i.f16(T.readUint16())),y[t][2*e+0]=a,y[t][2*e+1]=n}}let D=new Uint16Array(g.length);for(let e=0;e<g.length;e+=3)D[e+0]=g[e+2],D[e+1]=g[e+1],D[e+2]=g[e+0];if(p.addAttribute("position",new THREE.BufferAttribute(R,3)),p.setIndex(new THREE.BufferAttribute(D,1)),p.computeVertexNormals(),w){for(let e=0;e<b;e++){let t="uv"+(e>0?e+1:"");p.addAttribute(t,new THREE.BufferAttribute(y[e],2)),p.attributes[t].needsUpdate=!0}p.uvsNeedUpdate=!0}p.buffersNeedUpdate=!0;let F=f[t.materialIndex],L=null;F&&o[F.filename]&&(L=o[F.filename]);let S=r.getMaterial(F,L,e,n);if(!S){if(!l)return[];S=new THREE.MeshLambertMaterial({color:6009320,wireframe:!1,side:THREE.DoubleSide})}let _=new THREE.Mesh(p,S);F&&(_.materialFlags=F.materialFlags,_.materialFilename=F.filename),_.materialName=t.materialName,_.numLods=t.geometry.lods.length,_.lodOverride=a.data.lodOverride,_.flags=t.flags,_.numUV=b,m.push(_)}return m}t.exports={renderGeomChunk:l,getMeshesForFilename:function(e,t,a,r,i,s,d,m){r[e]?m(r[e].meshes,!0,r[e].boundingSphere):function(e,t,a,r,i,s,d){let m=[];a.readFile(e,!1,!1,void 0,void 0,!0).then(t=>{let f=t.buffer;try{if(!f)throw new Error("Could not find MFT entry for "+e);let t=new DataStream(f),h=new n(t,0),u=h.getChunk("modl"),c=h.getChunk("geom"),g=u.data.boundingSphere,p=g.center;g.radius+=Math.sqrt(p[0]*p[0]+Math.sqrt(p[1]*p[1]+p[2]*p[2]));let T=u.data.permutations[0].materials;const E=function(e,t){if(e>=T.length)return void t();let r=T[e];o[r.filename]?E(e+1,t):a.readFile(r.filename,!1,!1,void 0,void 0,!0).then(a=>{let i=a.buffer;if(i){let e=new DataStream(i),t=new n(e,0);o[r.filename]=t}E(e+1,t)})};E(0,function(){let e=l(a,c,u,r,i);for(let t of e){let e=2056;if(!(i||t.materialFlags&e))return;(!s||4!==t.flags&&1!==t.flags)&&m.push(t)}d(m,g)})}catch(t){console.warn("Failed rendering model "+e,t);let a=new THREE.Mesh(new THREE.BoxGeometry(200,2e3,200),new THREE.MeshNormalMaterial);a.flags=4,a.materialFlags=2056,a.lodOverride=[1e6,1e6],m.push(a),d(m)}})}(e,0,a,i,s,d,function(t,a){t&&(r[e]={meshes:t,boundingSphere:a}),m(t,!1,a)})},getFilesUsedByModel:function(e,t,a){let r=[e];t.readFile(e,!1,!1,void 0,void 0,!0).then(t=>{let i=t.buffer;try{if(!i)throw new Error("Could not find MFT entry for "+e);let t=new DataStream(i),a=new n(t,0).getChunk("modl").data.permutations[0].materials;for(let e of a){let t=e.filename;r.push(t),e.textures.forEach(function(e){r.push(e.filename)})}}catch(e){console.warn("Could not export any data",e)}a(r)})}}},{"../format/file/GW2File":18,"./Constants":19,"./MaterialUtils":25,"./MathUtils":26}],28:[function(e,t,a){t.exports={renderRect:function(e,t,a,n){let r=e.x1-e.x2,i=e.y1-e.y2;n||(n=1);let o=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2,l=t,d=new THREE.BoxGeometry(r,n,i);a=a||new THREE.MeshBasicMaterial({color:16711680,wireframe:!0});let m=new THREE.Mesh(d,a);return m.overdraw=!0,m.position.x=o,m.position.y=l,m.position.z=s,m}}},{}],29:[function(e,t,a){t.exports={getFragmentShader:function(){return["uniform vec2 uvScale;","uniform vec2 offset;","uniform sampler2D texturePicker;","uniform sampler2D texturePicker2;","uniform sampler2D texture1;","uniform sampler2D texture2;","uniform sampler2D texture3;","uniform sampler2D texture4;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"varying vec2 vUv;","varying vec3 vecNormal;","vec3 blend(","vec4 texture1, float a1, vec4 texture2, float a2,","vec4 texture3, float a3, vec4 texture4, float a4)","{","float depth = 2.0;","float alphaMult = 1.0;","float alphaAdd  = 0.0;","a1 *= 4.0;","a2 *= 4.0;","a3 *= 4.0;","a4 *= 4.0;","a1 =  a1+(1.5+texture1.a);","a2 =  a2+(1.5+texture2.a);","a3 =  a3+(1.5+texture3.a);","a4 =  a4+(1.5+texture4.a);","float ma = max(a1,a2);","ma = max(ma,a3);","ma = max(ma,a4);","ma -= depth;","float b1 = max(a1 - ma, 0.0);","float b2 = max(a2 - ma, 0.0);","float b3 = max(a3 - ma, 0.0);","float b4 = max(a4 - ma, 0.0);","return (","texture1.rgb * b1 + texture2.rgb * b2 +","texture3.rgb * b3 + texture4.rgb * b4 ",") / (b1 + b2 + b3 + b4);","}","void main( void ) {","vec2 position = vUv*uvScale;","float edge = 1.0/1024.0;","vec2 compPos = edge + (vUv*0.25 + offset) * (1.0-edge*2.0);","vec4 tp1 = texture2D( texturePicker, compPos);","vec4 tp2 = texture2D( texturePicker2, compPos);","vec4 composite = tp1;","vec4 t1 = texture2D( texture1, position );","vec4 t2 = texture2D( texture2, position );","vec4 t3 = texture2D( texture3, position );","vec4 t4 = texture2D( texture4, position );","vec3 color = blend(","t1, tp1.a,","t2, tp1.b,","t3, tp1.g,","t4, tp1.r",");","color *= 0.5+tp2.r;","gl_FragColor = vec4(color,1.0);",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},getVertexShader:function(){return["varying vec2 vUv;","varying vec3 vecNormal;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main()","{","vUv =  uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vecNormal = (modelMatrix * vec4(normal, 0.0)).xyz;","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n")}}},{}]},{},[8])(8)});
//# sourceMappingURL=T3D-latest.js.map
